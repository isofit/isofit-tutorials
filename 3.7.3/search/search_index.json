{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"About","text":""},{"location":"#isofit-tutorials","title":"ISOFIT Tutorials","text":"<p>Welcome to the ISOFIT tutorials repository! This repository contains a collection of Jupyter notebooks that serve as tutorials, examples, and further documentation for the ISOFIT project. These notebooks are designed to work seamlessly with the official ISOFIT Docker image, ensuring a hassle-free setup process.</p> <p>ISOFIT is a powerful tool for atmospheric correction of remote sensing data, particularly hyperspectral data. These notebooks provide step-by-step guides and demonstrations on using ISOFIT for atmospheric correction, making it easier for users to understand and utilize the capabilities of the ISOFIT software.</p>"},{"location":"#license","title":"License","text":"<p>The ISOFIT Tutorials project is licensed under the Apache v2.0 License.</p>"},{"location":"notebooks/apply_oe/","title":"Apply OE","text":"In\u00a0[1]: Copied! <pre>from isofit.utils.apply_oe import apply_oe\n\nprint(apply_oe.__doc__)\n</pre> from isofit.utils.apply_oe import apply_oe  print(apply_oe.__doc__) <pre>\nApplies OE over a flightline using a radiative transfer engine. This executes\nISOFIT in a generalized way, accounting for the types of variation that might be\nconsidered typical.\n\nObservation (obs) and location (loc) files are used to determine appropriate\ngeometry lookup tables and provide a heuristic means of determining atmospheric\nwater ranges.\n\nParameters\n----------\ninput_radiance : str\n    Radiance data cube. Expected to be ENVI format\ninput_loc : str\n    Location data cube of shape (Lon, Lat, Elevation). Expected to be ENVI format\ninput_obs : str\n    Observation data cube of shape:\n        (path length, to-sensor azimuth, to-sensor zenith,\n        to-sun azimuth, to-sun zenith, phase,\n        slope, aspect, cosine i, UTC time)\n    Expected to be ENVI format\nworking_directory : str\n    Directory to stage multiple outputs, will contain subdirectories\nsensor : str\n    The sensor used for acquisition, will be used to set noise and datetime\n    settings\nsurface_path : str\n    Path to surface model or json dict of surface model configuration\ncopy_input_files : bool, default=False\n    Flag to choose to copy input_radiance, input_loc, and input_obs locally into\n    the working_directory\nmodtran_path : str, default=None\n    Location of MODTRAN utility. Alternately set with `MODTRAN_DIR` environment\n    variable\nwavelength_path : str, default=None\n    Location to get wavelength information from, if not specified the radiance\n    header will be used\nsurface_category : str, default=\"multicomponent_surface\"\n    The type of ISOFIT surface priors to use.  Default is multicomponent_surface\naerosol_climatology_path : str, default=None\n    Specific aerosol climatology information to use in MODTRAN\nrdn_factors_path : str, default=None\n    Specify a radiometric correction factor, if desired\natmosphere_type : str, default=\"ATM_MIDLAT_SUMMER\"\n    Atmospheric profile to be used for MODTRAN simulations.  Unused for other\n    radiative transfer models.\nchannelized_uncertainty_path : str, default=None\n    Path to a wavelength-specific channelized uncertainty file - used to augment Sy in the OE formalism\ninstrument_noise_path : str, default=None\n    Path to a wavelength-specific instrument noise file, used to derive per-wavelength NEDL / SNR\ndn_uncertainty_file:  str, default=None\n    Path to a linearity .mat file to augment S matrix with linearity uncertainty\nmodel_discrepancy_path : str, default=None\n    Modifies S_eps in the OE formalism as the Gamma additive term, as:\n    S_eps = Sy + Kb.dot(self.Sb).dot(Kb.T) + Gamma\nlut_config_file : str, default=None\n    Path to a look up table configuration file, which will override defaults\n    choices\nmultiple_restarts : bool, default=False\n    Use multiple initial starting poitns for each OE ptimization run, using\n    the corners of the atmospheric variables as starting points.  This gives\n    a more robust, albeit more expensive, solution.\nlogging_level : str, default=\"INFO\"\n    Logging level with which to run ISOFIT\nlog_file : str, default=None\n    File path to write ISOFIT logs to\nn_cores : int, default=1\n    Number of cores to run ISOFIT with. Substantial parallelism is available, and\n    full runs will be very slow in serial. Suggested to max this out on the\n    available system\npresolve : int, default=False\n    Flag to use a presolve mode to estimate the available atmospheric water range.\n    Runs a preliminary inversion over the image with a 1-D LUT of water vapor, and\n    uses the resulting range (slightly expanded) to bound determine the full LUT.\n    Advisable to only use with small cubes or in concert with the empirical_line\n    setting, or a significant speed penalty will be incurred\nempirical_line : bool, default=False\n    Use an empirical line interpolation to run full inversions over only a subset\n    of pixels, determined using a SLIC superpixel segmentation, and use a KDTREE of\n    local solutions to interpolate radiance-&gt;reflectance. Generally a good option\n    if not trying to analyze the atmospheric state at fine scale resolution.\n    Mutually exclusive with analytical_line\nanalytical_line : bool, default=False\n    Use an analytical solution to the fixed atmospheric state to solve for each\n    pixel.  Starts by running a full OE retrieval on each SLIC superpixel, then\n    interpolates the atmospheric state to each pixel, and closes with the\n    analytical solution.\n    Mutually exclusive with empirical_line\nray_temp_dir : str, default=\"/tmp/ray\"\n    Location of temporary directory for ray parallelization engine\nemulator_base : str, default=None\n    Location of emulator base path. Point this at the 3C or 6C .h5 files.\n    sRTMnet to use the emulator instead of MODTRAN. An additional file with the\n    same basename and the extention _aux.npz must accompany\n    e.g. /path/to/emulator.h5 /path/to/emulator_aux.npz\nsegmentation_size : int, default=40\n    If empirical_line is enabled, sets the size of segments to construct\nnum_neighbors : list[int], default=[]\n    Forced number of neighbors for empirical line extrapolation - overides default\n    set from segmentation_size parameter\natm_sigma : list[int], default=[2]\n    A list of smoothing factors to use during the atmospheric interpolation, one\n    for each atmospheric parameter (or broadcast to all if only one is provided).\n    Only used with the analytical line.\npressure_elevation : bool, default=False\n    Flag to retrieve elevation\nprebuilt_lut : str, default=None\n    Use this pre-constructed look up table for all retrievals. Must be an\n    ISOFIT-compatible RTE NetCDF\nno_min_lut_spacing : bool, default=False\n    Don't allow the LUTConfig to remove a LUT dimension because of minimal spacing.\ninversion_windows : list[float], default=None\n    Override the default inversion windows.  Will supercede any sensor specific\n    defaults that are in place.\n    Must be in 2-item tuples\nconfig_only : bool, default=False\n    Generates the configuration then exits before execution. If presolve is\n    enabled, that run will still occur.\ninterpolate_bad_rdn : bool, default=False\n    Flag to perform a per-pixel interpolation across no-data and NaN data bands.\n    Does not interpolate vectors that are entire no-data or NaN, only partial.\n    Currently only designed for wavelength interpolation on spectra.\n    Does NOT do any spatial interpolation\ninterpolate_inplace : bool, default=False\n    Flag to tell interpolation to work on the file in place, or generate a\n    new interpolated rdn file. The location of the new file will be in the\n    \"input\" directory within the working directory.\nskyview_factor : str, default=None\n    Flag to determine method to account for skyview factor. Default is None, creating an array of 1s.\n    Other option is \"slope\" which will approx. based on cos^2(slope/2).\n    Other option is a path to a skyview ENVI file computed via skyview.py utility or other source.\n    Please note data must range from 0-1.\nresources : bool, default=False\n    Enables the system resource tracker. Must also have the log_file set.\nretrieve_co2 : bool, default=False\n    Flag to retrieve CO2 in the state vector. Only available with emulator at the moment.\neof_path : str, default=None\n    Add 1 or 2 Empirical Orthogonal Functions to the state vector.  File is a 1-2 column text file\n    with one number per instrument channel.\nterrain_style : str, default=dem\n    Flag to set the terrain style.  dem uses provided obs values, flat sets the surface to the spheroid\n\nReferences\n----------\nD.R. Thompson, A. Braverman,P.G. Brodrick, A. Candela, N. Carbon, R.N. Clark,D. Connelly, R.O. Green, R.F.\nKokaly, L. Li, N. Mahowald, R.L. Miller, G.S. Okin, T.H.Painter, G.A. Swayze, M. Turmon, J. Susilouto, and\nD.S. Wettergreen. Quantifying Uncertainty for Remote Spectroscopy of Surface Composition. Remote Sensing of\nEnvironment, 2020. doi: https://doi.org/10.1016/j.rse.2020.111898.\n\nsRTMnet emulator:\nP.G. Brodrick, D.R. Thompson, J.E. Fahlen, M.L. Eastwood, C.M. Sarture, S.R. Lundeen, W. Olson-Duvall,\nN. Carmon, and R.O. Green. Generalized radiative transfer emulation for imaging spectroscopy reflectance\nretrievals. Remote Sensing of Environment, 261:112476, 2021.doi: 10.1016/j.rse.2021.112476.\n\n</pre> <p>The Apply OE function can leverage a large number of input parameters, but most are optional. The important inputs are the non-optional arguments:</p> <p><code>INPUT_RADIANCE</code> <code>INPUT_LOC</code> <code>INPUT_OBS</code> <code>WORKING_DIRECTORY</code> <code>SENSOR</code> and <code>--surface_path</code>.</p> <p>which must be entered in the specified order (except <code>--surface_path</code> which can be added at any point but still required). Descriptions of each are found in the docstring printed above. It is important to note that the <code>INPUT_RADIANCE</code>, <code>INPUT_LOC</code>, and <code>INPUT_OBS</code> are ENVI raster data formats that must be at the same row-column dimensions. The <code>--surface_path</code> points Isofit torwards the constructed prior distribution file for surface reflectance. Optional arguments are denoted by the '--' in their name, e.g.  <code>--modtran_path</code>, <code>--pressure_elevation</code>. It is important to note that the default radiative transfer engine (RTE) is currently set to Modtran. You must specify an <code>--emulator_path</code> without a Modtran installation.</p> <p>Here,</p> <pre><code>$IC/ang20170323t202244_rdn_7000-7010\n$IC/ang20170323t202244_loc_7000-7010\n$IC/ang20170323t202244_obs_7000-7010\n</code></pre> <p>are the radiance, location, and observational geometry files respectively. The <code>\\</code> tells the CLI call to expect a multi-line input. The remaining two requried parameters are <code>ang</code>, the sensor designation (AVIRIS-NG), and the <code>--surface_path</code> pointing to the surface configuration file which will be built at runtime.</p> <p>The remaining arguments set Apply OE to run with:</p> <ol> <li><code>--emulator_base</code> points isofit to the location of the sRTMnet emulator to usse as the radiative transfer engine (RTE)</li> <li><code>--n_cores = 10</code> CPU cores</li> <li>The <code>--presolve</code> algorithm to narrow down the water vapor retrievals</li> </ol> In\u00a0[2]: Copied! <pre># Alternatively, you can programatically call apply_oe. If you executed apply_oe via the command line above, do not run this\n# We use the env object to retrieve the actual location of the ISOFIT extra dependencies instead of assuming where they could be\nimport os\nimport shutil\n\nfrom isofit.utils.apply_oe import apply_oe\nfrom isofit.data import env\n\noutput = env.path(\"examples\", \"image_cube\", \"small\")\n\n# Cleanup any previous runs; comment this out if you want to preserve a previous run's output\nif (o := output / \"output\").exists():\n    shutil.rmtree(o)\n\napply_oe(\n    input_radiance    = str(env.path(\"examples\", \"image_cube\", \"small\", \"ang20170323t202244_rdn_7000-7010\")),\n    input_loc         = str(env.path(\"examples\", \"image_cube\", \"small\", \"ang20170323t202244_loc_7000-7010\")),\n    input_obs         = str(env.path(\"examples\", \"image_cube\", \"small\", \"ang20170323t202244_obs_7000-7010\")),\n    working_directory = str(output),\n    sensor            = \"ang\",\n    surface_path      = str(env.path(\"examples\", \"image_cube\", \"small\", \"configs\", \"surface.json\")),\n    emulator_base     = str(env.path(\"srtmnet\", key=\"srtmnet.file\")),\n    presolve          = True,\n    n_cores           = os.cpu_count(),\n)\n</pre> # Alternatively, you can programatically call apply_oe. If you executed apply_oe via the command line above, do not run this # We use the env object to retrieve the actual location of the ISOFIT extra dependencies instead of assuming where they could be import os import shutil  from isofit.utils.apply_oe import apply_oe from isofit.data import env  output = env.path(\"examples\", \"image_cube\", \"small\")  # Cleanup any previous runs; comment this out if you want to preserve a previous run's output if (o := output / \"output\").exists():     shutil.rmtree(o)  apply_oe(     input_radiance    = str(env.path(\"examples\", \"image_cube\", \"small\", \"ang20170323t202244_rdn_7000-7010\")),     input_loc         = str(env.path(\"examples\", \"image_cube\", \"small\", \"ang20170323t202244_loc_7000-7010\")),     input_obs         = str(env.path(\"examples\", \"image_cube\", \"small\", \"ang20170323t202244_obs_7000-7010\")),     working_directory = str(output),     sensor            = \"ang\",     surface_path      = str(env.path(\"examples\", \"image_cube\", \"small\", \"configs\", \"surface.json\")),     emulator_base     = str(env.path(\"srtmnet\", key=\"srtmnet.file\")),     presolve          = True,     n_cores           = os.cpu_count(), ) <pre>The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/small/ang20170323t202244_rdn_7000-7010\n</pre> <pre>The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/small/ang20170323t202244_loc_7000-7010\n</pre> <pre>The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/small/ang20170323t202244_obs_7000-7010\n</pre> <pre>INFO:2026-02-24,21:02:13 || apply_oe.py:apply_oe() | Checking input data files...\n</pre> <pre>\n---------------------------------------------------------------------------\nFileNotFoundError                         Traceback (most recent call last)\nCell In[2], line 15\n     12 if (o := output / \"output\").exists():\n     13     shutil.rmtree(o)\n---&gt; 15 apply_oe(\n     16     input_radiance    = str(env.path(\"examples\", \"image_cube\", \"small\", \"ang20170323t202244_rdn_7000-7010\")),\n     17     input_loc         = str(env.path(\"examples\", \"image_cube\", \"small\", \"ang20170323t202244_loc_7000-7010\")),\n     18     input_obs         = str(env.path(\"examples\", \"image_cube\", \"small\", \"ang20170323t202244_obs_7000-7010\")),\n     19     working_directory = str(output),\n     20     sensor            = \"ang\",\n     21     surface_path      = str(env.path(\"examples\", \"image_cube\", \"small\", \"configs\", \"surface.json\")),\n     22     emulator_base     = str(env.path(\"srtmnet\", key=\"srtmnet.file\")),\n     23     presolve          = True,\n     24     n_cores           = os.cpu_count(),\n     25 )\n\nFile ~/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/isofit/utils/apply_oe.py:330, in apply_oe(input_radiance, input_loc, input_obs, working_directory, sensor, surface_path, copy_input_files, modtran_path, wavelength_path, surface_category, surface_class_file, classify_multisurface, aerosol_climatology_path, rdn_factors_path, atmosphere_type, channelized_uncertainty_path, instrument_noise_path, dn_uncertainty_file, model_discrepancy_path, lut_config_file, multiple_restarts, logging_level, log_file, n_cores, presolve, empirical_line, analytical_line, ray_temp_dir, emulator_base, segmentation_size, num_neighbors, atm_sigma, pressure_elevation, prebuilt_lut, no_min_lut_spacing, inversion_windows, config_only, interpolate_bad_rdn, interpolate_inplace, skyview_factor, resources, retrieve_co2, eof_path, terrain_style)\n    325         logging.error(\n    326             \"The resources.jsonl will only be generated when a log file is also set\"\n    327         )\n    329 logging.info(\"Checking input data files...\")\n--&gt; 330 rdn_dataset = envi.open(envi_header(input_radiance))\n    331 rdn_size = (rdn_dataset.shape[0], rdn_dataset.shape[1])\n    332 del rdn_dataset\n\nFile ~/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/spectral/io/envi.py:304, in open(file, image)\n    272 def open(file, image=None):\n    273     '''\n    274     Opens an image or spectral library with an associated ENVI HDR header file.\n    275 \n   (...)    301     Capitalized versions of the file extensions are also searched.\n    302     '''\n--&gt; 304     header_path = find_file_path(file)\n    305     h = read_envi_header(header_path)\n    306     check_compatibility(h)\n\nFile ~/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/spectral/io/spyfile.py:122, in find_file_path(filename)\n    118 if not pathname:\n    119     msg = 'Unable to locate file \"%s\". If the file exists, ' \\\n    120       'use its full path or place its directory in the ' \\\n    121       'SPECTRAL_DATA environment variable.' % filename\n--&gt; 122     raise FileNotFoundError(msg)\n    123 return pathname\n\nFileNotFoundError: Unable to locate file \"/home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/small/ang20170323t202244_rdn_7000-7010.hdr\". If the file exists, use its full path or place its directory in the SPECTRAL_DATA environment variable.</pre> <p>We can examine both the inputs and outputs of Apply OE with this run call:</p> In\u00a0[3]: Copied! <pre># Common imports\nimport os\nfrom pathlib import Path\n\nfrom spectral import envi\nfrom matplotlib import pyplot as plt\nimport numpy as np\n\nfrom isofit.core.common import envi_header\nfrom isofit.data import env\n</pre> # Common imports import os from pathlib import Path  from spectral import envi from matplotlib import pyplot as plt import numpy as np  from isofit.core.common import envi_header from isofit.data import env <pre>INFO:2026-02-24,21:02:14 || font_manager.py:__init__() | Failed to extract font properties from /usr/share/fonts/truetype/noto/NotoColorEmoji.ttf: Can not load face (unknown file format; error code 0x2)\n</pre> <pre>INFO:2026-02-24,21:02:14 || font_manager.py:_load_fontmanager() | generated new fontManager\n</pre> In\u00a0[4]: Copied! <pre># Load the input files\nrdn_path = env.path(\"examples\", \"image_cube\", \"small\", \"ang20170323t202244_rdn_7000-7010\")\nloc_path = env.path(\"examples\", \"image_cube\", \"small\", \"ang20170323t202244_loc_7000-7010\")\nobs_path = env.path(\"examples\", \"image_cube\", \"small\", \"ang20170323t202244_obs_7000-7010\")\n\nrdn = envi.open(envi_header(str(rdn_path)))\nloc = envi.open(envi_header(str(loc_path)))\nobs = envi.open(envi_header(str(obs_path)))\n\nrdn_im = rdn.open_memmap(interleave='bip')\nloc_im = loc.open_memmap(interleave='bip')\nobs_im = obs.open_memmap(interleave='bip')\n</pre> # Load the input files rdn_path = env.path(\"examples\", \"image_cube\", \"small\", \"ang20170323t202244_rdn_7000-7010\") loc_path = env.path(\"examples\", \"image_cube\", \"small\", \"ang20170323t202244_loc_7000-7010\") obs_path = env.path(\"examples\", \"image_cube\", \"small\", \"ang20170323t202244_obs_7000-7010\")  rdn = envi.open(envi_header(str(rdn_path))) loc = envi.open(envi_header(str(loc_path))) obs = envi.open(envi_header(str(obs_path)))  rdn_im = rdn.open_memmap(interleave='bip') loc_im = loc.open_memmap(interleave='bip') obs_im = obs.open_memmap(interleave='bip') <pre>ERROR:2026-02-24,21:02:14 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/small/ang20170323t202244_rdn_7000-7010\n</pre> <pre>ERROR:2026-02-24,21:02:14 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/small/ang20170323t202244_loc_7000-7010\n</pre> <pre>ERROR:2026-02-24,21:02:14 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/small/ang20170323t202244_obs_7000-7010\n</pre> <pre>\n---------------------------------------------------------------------------\nFileNotFoundError                         Traceback (most recent call last)\nCell In[4], line 6\n      3 loc_path = env.path(\"examples\", \"image_cube\", \"small\", \"ang20170323t202244_loc_7000-7010\")\n      4 obs_path = env.path(\"examples\", \"image_cube\", \"small\", \"ang20170323t202244_obs_7000-7010\")\n----&gt; 6 rdn = envi.open(envi_header(str(rdn_path)))\n      7 loc = envi.open(envi_header(str(loc_path)))\n      8 obs = envi.open(envi_header(str(obs_path)))\n\nFile ~/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/spectral/io/envi.py:304, in open(file, image)\n    272 def open(file, image=None):\n    273     '''\n    274     Opens an image or spectral library with an associated ENVI HDR header file.\n    275 \n   (...)    301     Capitalized versions of the file extensions are also searched.\n    302     '''\n--&gt; 304     header_path = find_file_path(file)\n    305     h = read_envi_header(header_path)\n    306     check_compatibility(h)\n\nFile ~/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/spectral/io/spyfile.py:122, in find_file_path(filename)\n    118 if not pathname:\n    119     msg = 'Unable to locate file \"%s\". If the file exists, ' \\\n    120       'use its full path or place its directory in the ' \\\n    121       'SPECTRAL_DATA environment variable.' % filename\n--&gt; 122     raise FileNotFoundError(msg)\n    123 return pathname\n\nFileNotFoundError: Unable to locate file \"/home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/small/ang20170323t202244_rdn_7000-7010.hdr\". If the file exists, use its full path or place its directory in the SPECTRAL_DATA environment variable.</pre> In\u00a0[5]: Copied! <pre># Print the bands of the input files\nprint('Band names in the location file:')\n[print(f\"{i}\") for i in loc.metadata['band names']]\n\nprint()\nprint('Band names in the observational geometry file:')\ntemp = [print(f\"{i}\") for i in obs.metadata['band names']]\n</pre> # Print the bands of the input files print('Band names in the location file:') [print(f\"{i}\") for i in loc.metadata['band names']]  print() print('Band names in the observational geometry file:') temp = [print(f\"{i}\") for i in obs.metadata['band names']] <pre>Band names in the location file:\n</pre> <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[5], line 3\n      1 # Print the bands of the input files\n      2 print('Band names in the location file:')\n----&gt; 3 [print(f\"{i}\") for i in loc.metadata['band names']]\n      5 print()\n      6 print('Band names in the observational geometry file:')\n\nNameError: name 'loc' is not defined</pre> In\u00a0[6]: Copied! <pre># Plot the input data\nnormalize = lambda x, vmin, vmax:  (x - vmin) / (vmax - vmin)\nbands = [55, 35, 15]\n\nfig, axs = plt.subplots(1, 3, sharex=True, sharey=True, figsize=(13, 4))\nplot = axs[0].imshow(normalize(rdn_im[..., bands], 0, 15))\nplot = axs[1].imshow(loc_im[..., 0])\nplot = axs[2].imshow(obs_im[..., 4])\n\ntitle = axs[0].set_title('Radiance (RGB)')\ntitle = axs[1].set_title('Longitude (WGS-84)')\ntitle = axs[2].set_title('Solar zenith angle (Deg)')\n</pre> # Plot the input data normalize = lambda x, vmin, vmax:  (x - vmin) / (vmax - vmin) bands = [55, 35, 15]  fig, axs = plt.subplots(1, 3, sharex=True, sharey=True, figsize=(13, 4)) plot = axs[0].imshow(normalize(rdn_im[..., bands], 0, 15)) plot = axs[1].imshow(loc_im[..., 0]) plot = axs[2].imshow(obs_im[..., 4])  title = axs[0].set_title('Radiance (RGB)') title = axs[1].set_title('Longitude (WGS-84)') title = axs[2].set_title('Solar zenith angle (Deg)') <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[6], line 6\n      3 bands = [55, 35, 15]\n      5 fig, axs = plt.subplots(1, 3, sharex=True, sharey=True, figsize=(13, 4))\n----&gt; 6 plot = axs[0].imshow(normalize(rdn_im[..., bands], 0, 15))\n      7 plot = axs[1].imshow(loc_im[..., 0])\n      8 plot = axs[2].imshow(obs_im[..., 4])\n\nNameError: name 'rdn_im' is not defined</pre> <p>The input image doesn't look like much because this is just a 10x10 pixel example. However we see per-pixel spectral variation in the radiance RGBs, and systematic variation in the location and geometric variables.</p> In\u00a0[7]: Copied! <pre># Load the output files\nrfl_path = env.path(\"examples\", \"image_cube\", \"small\", \"output\", \"ang20170323t202244_rfl\")\nstate_path = env.path(\"examples\", \"image_cube\", \"small\", \"output\", \"ang20170323t202244_state\")\nuncert_path = env.path(\"examples\", \"image_cube\", \"small\", \"output\", \"ang20170323t202244_uncert\")\n\nrfl = envi.open(envi_header(str(rfl_path)))\nstate = envi.open(envi_header(str(state_path)))\nuncert = envi.open(envi_header(str(uncert_path)))\n\nrfl_im = rfl.open_memmap(interleave='bip')\nstate_im = state.open_memmap(interleave='bip')\nuncert_im = uncert.open_memmap(interleave='bip')\n\nprint(f'Shape of the _rfl file: {rfl_im.shape}')\nprint(f'Shape of the _state file: {state_im.shape}')\nprint(f'Shape of the _uncert file: {uncert_im.shape}')\n</pre> # Load the output files rfl_path = env.path(\"examples\", \"image_cube\", \"small\", \"output\", \"ang20170323t202244_rfl\") state_path = env.path(\"examples\", \"image_cube\", \"small\", \"output\", \"ang20170323t202244_state\") uncert_path = env.path(\"examples\", \"image_cube\", \"small\", \"output\", \"ang20170323t202244_uncert\")  rfl = envi.open(envi_header(str(rfl_path))) state = envi.open(envi_header(str(state_path))) uncert = envi.open(envi_header(str(uncert_path)))  rfl_im = rfl.open_memmap(interleave='bip') state_im = state.open_memmap(interleave='bip') uncert_im = uncert.open_memmap(interleave='bip')  print(f'Shape of the _rfl file: {rfl_im.shape}') print(f'Shape of the _state file: {state_im.shape}') print(f'Shape of the _uncert file: {uncert_im.shape}') <pre>ERROR:2026-02-24,21:02:14 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/small/output/ang20170323t202244_rfl\n</pre> <pre>ERROR:2026-02-24,21:02:14 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/small/output/ang20170323t202244_state\n</pre> <pre>ERROR:2026-02-24,21:02:14 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/small/output/ang20170323t202244_uncert\n</pre> <pre>\n---------------------------------------------------------------------------\nFileNotFoundError                         Traceback (most recent call last)\nCell In[7], line 6\n      3 state_path = env.path(\"examples\", \"image_cube\", \"small\", \"output\", \"ang20170323t202244_state\")\n      4 uncert_path = env.path(\"examples\", \"image_cube\", \"small\", \"output\", \"ang20170323t202244_uncert\")\n----&gt; 6 rfl = envi.open(envi_header(str(rfl_path)))\n      7 state = envi.open(envi_header(str(state_path)))\n      8 uncert = envi.open(envi_header(str(uncert_path)))\n\nFile ~/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/spectral/io/envi.py:304, in open(file, image)\n    272 def open(file, image=None):\n    273     '''\n    274     Opens an image or spectral library with an associated ENVI HDR header file.\n    275 \n   (...)    301     Capitalized versions of the file extensions are also searched.\n    302     '''\n--&gt; 304     header_path = find_file_path(file)\n    305     h = read_envi_header(header_path)\n    306     check_compatibility(h)\n\nFile ~/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/spectral/io/spyfile.py:122, in find_file_path(filename)\n    118 if not pathname:\n    119     msg = 'Unable to locate file \"%s\". If the file exists, ' \\\n    120       'use its full path or place its directory in the ' \\\n    121       'SPECTRAL_DATA environment variable.' % filename\n--&gt; 122     raise FileNotFoundError(msg)\n    123 return pathname\n\nFileNotFoundError: Unable to locate file \"/home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/small/output/ang20170323t202244_rfl.hdr\". If the file exists, use its full path or place its directory in the SPECTRAL_DATA environment variable.</pre> <p>The difference between the <code>_rfl</code> file and the <code>_state</code> file is that the <code>_rfl</code> file only contains the solutions for surface reflectance variables. Here, the AVIRIS-NG image contains 425 wavelength bands. As a result, the <code>_rfl</code> contains 425 bands. The <code>_state</code> and <code>_uncert</code> files contain the surface reflectance solutions and uncertainty calculated as the standard deviation of the posterior distributions for the 425 wavelength bands and for non-reflectance statevector elements; here, aerosol optical depth (AOD) and water vapor (H2O).</p> In\u00a0[8]: Copied! <pre># Plot the output data\nnormalize = lambda x, vmin, vmax:  (x - vmin) / (vmax - vmin)\nbands = [55, 35, 15]\n\nfig, axs = plt.subplots(2, 2, sharex=True, sharey=True, figsize=(8, 8))\naxs = np.ravel(axs)\nplot = axs[0].imshow(normalize(rfl_im[..., bands], 0, 0.3))\nuncert = axs[1].imshow(uncert_im[..., 55])\naod = axs[2].imshow(state_im[..., -2])\nh2o = axs[3].imshow(state_im[..., -1])\n\nplt.colorbar(uncert)\nplt.colorbar(aod)\nplt.colorbar(h2o)\n\ntitle = axs[0].set_title('Reflectance')\ntitle = axs[1].set_title('Uncertainty (at 650 nm)')\ntitle = axs[2].set_title('AOD')\ntitle = axs[3].set_title('H2O')\n</pre> # Plot the output data normalize = lambda x, vmin, vmax:  (x - vmin) / (vmax - vmin) bands = [55, 35, 15]  fig, axs = plt.subplots(2, 2, sharex=True, sharey=True, figsize=(8, 8)) axs = np.ravel(axs) plot = axs[0].imshow(normalize(rfl_im[..., bands], 0, 0.3)) uncert = axs[1].imshow(uncert_im[..., 55]) aod = axs[2].imshow(state_im[..., -2]) h2o = axs[3].imshow(state_im[..., -1])  plt.colorbar(uncert) plt.colorbar(aod) plt.colorbar(h2o)  title = axs[0].set_title('Reflectance') title = axs[1].set_title('Uncertainty (at 650 nm)') title = axs[2].set_title('AOD') title = axs[3].set_title('H2O') <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[8], line 7\n      5 fig, axs = plt.subplots(2, 2, sharex=True, sharey=True, figsize=(8, 8))\n      6 axs = np.ravel(axs)\n----&gt; 7 plot = axs[0].imshow(normalize(rfl_im[..., bands], 0, 0.3))\n      8 uncert = axs[1].imshow(uncert_im[..., 55])\n      9 aod = axs[2].imshow(state_im[..., -2])\n\nNameError: name 'rfl_im' is not defined</pre> <p>See the following CLI call to run Apply OE with the analytical line algorithm:</p> <pre>  IC=$(isofit path examples)/image_cube/medium EX=$(isofit path examples)/image_cube/medium \\\n  isofit apply_oe \\\n  $IC/ang20170323t202244_rdn_7k-8k \\\n  $IC/ang20170323t202244_loc_7k-8k \\\n  $IC/ang20170323t202244_obs_7k-8k \\\n  $EX \\\n  ang \\\n  --surface_path $EX/configs/surface.json \\\n  --emulator_base $(isofit path srtmnet --key file) \\\n  --n_cores 10 \\\n  --presolve \\\n  --analytical_line \\\n  --segmentation_size 50 \\\n  --log_file $EX/log.txt\n</pre> <p>Most of the input parameters are identical to the per-pixel application above. However, we've added a <code>--log_file</code>, the <code>--analytical_line</code> flag, and a <code>--segmentation_size</code>. The <code>--log_file</code> points the program to write a text file to print logging statements during run time. The <code>--analytical_line</code> flag tells Isofit to use the analytical line algorithm.</p> <p>A simple overview for the anylitical line algorithm:</p> <ol> <li><p>All three input files are \"segmented\" into superpixel blocks using the SLIC algorithm. The  <code>--segmentation_size</code> value sets the number of pixels that each superpixel contains.</p> </li> <li><p>At the superpixel resolution, Isofit solves for the OE solutions, which provides both surface and atmospheric state variables.</p> </li> <li><p>Atmospheric state variables are spatially interpolated to full image resolution. The spatial interpolation uses the Apply OE parameters <code>--num_neighbors</code> and <code>--atm_sigma</code>.</p> </li> <li><p>With a fixed atmosphere, we leverage a closed form solution for surface state elements that allows for a solution convergence in a single iteration.</p> </li> </ol> In\u00a0[9]: Copied! <pre># Alternatively, you can programatically call apply_oe. If you executed apply_oe via the command line above, do not run this\n# We use the env object to retrieve the actual location of the ISOFIT extra dependencies instead of assuming where they could be\nimport os\nimport shutil\n\nfrom isofit.utils.apply_oe import apply_oe\nfrom isofit.data import env\n\noutput = env.path(\"examples\", \"image_cube\", \"medium\")\n\n# Cleanup any previous runs; comment this out if you want to preserve a previous run's output\nif (o := output / \"output\").exists():\n    shutil.rmtree(o)\n\napply_oe(\n    input_radiance    = str(env.path(\"examples\", \"image_cube\", \"medium\", \"ang20170323t202244_rdn_7000-7010\")),\n    input_loc         = str(env.path(\"examples\", \"image_cube\", \"medium\", \"ang20170323t202244_loc_7000-7010\")),\n    input_obs         = str(env.path(\"examples\", \"image_cube\", \"medium\", \"ang20170323t202244_obs_7000-7010\")),\n    working_directory = str(output),\n    sensor            = \"ang\",\n    surface_path      = str(env.path(\"examples\", \"image_cube\", \"medium\", \"configs\", \"surface.json\")),\n    emulator_base     = str(env.path(\"srtmnet\", key=\"srtmnet.file\")),\n    presolve          = True,\n    n_cores           = os.cpu_count(),\n    analytical_line   = True,\n    segmentation_size = 50,\n)\n</pre> # Alternatively, you can programatically call apply_oe. If you executed apply_oe via the command line above, do not run this # We use the env object to retrieve the actual location of the ISOFIT extra dependencies instead of assuming where they could be import os import shutil  from isofit.utils.apply_oe import apply_oe from isofit.data import env  output = env.path(\"examples\", \"image_cube\", \"medium\")  # Cleanup any previous runs; comment this out if you want to preserve a previous run's output if (o := output / \"output\").exists():     shutil.rmtree(o)  apply_oe(     input_radiance    = str(env.path(\"examples\", \"image_cube\", \"medium\", \"ang20170323t202244_rdn_7000-7010\")),     input_loc         = str(env.path(\"examples\", \"image_cube\", \"medium\", \"ang20170323t202244_loc_7000-7010\")),     input_obs         = str(env.path(\"examples\", \"image_cube\", \"medium\", \"ang20170323t202244_obs_7000-7010\")),     working_directory = str(output),     sensor            = \"ang\",     surface_path      = str(env.path(\"examples\", \"image_cube\", \"medium\", \"configs\", \"surface.json\")),     emulator_base     = str(env.path(\"srtmnet\", key=\"srtmnet.file\")),     presolve          = True,     n_cores           = os.cpu_count(),     analytical_line   = True,     segmentation_size = 50, ) <pre>ERROR:2026-02-24,21:02:15 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/medium/ang20170323t202244_rdn_7000-7010\n</pre> <pre>ERROR:2026-02-24,21:02:15 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/medium/ang20170323t202244_loc_7000-7010\n</pre> <pre>ERROR:2026-02-24,21:02:15 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/medium/ang20170323t202244_obs_7000-7010\n</pre> <pre>INFO:2026-02-24,21:02:15 || apply_oe.py:apply_oe() | Checking input data files...\n</pre> <pre>\n---------------------------------------------------------------------------\nFileNotFoundError                         Traceback (most recent call last)\nCell In[9], line 15\n     12 if (o := output / \"output\").exists():\n     13     shutil.rmtree(o)\n---&gt; 15 apply_oe(\n     16     input_radiance    = str(env.path(\"examples\", \"image_cube\", \"medium\", \"ang20170323t202244_rdn_7000-7010\")),\n     17     input_loc         = str(env.path(\"examples\", \"image_cube\", \"medium\", \"ang20170323t202244_loc_7000-7010\")),\n     18     input_obs         = str(env.path(\"examples\", \"image_cube\", \"medium\", \"ang20170323t202244_obs_7000-7010\")),\n     19     working_directory = str(output),\n     20     sensor            = \"ang\",\n     21     surface_path      = str(env.path(\"examples\", \"image_cube\", \"medium\", \"configs\", \"surface.json\")),\n     22     emulator_base     = str(env.path(\"srtmnet\", key=\"srtmnet.file\")),\n     23     presolve          = True,\n     24     n_cores           = os.cpu_count(),\n     25     analytical_line   = True,\n     26     segmentation_size = 50,\n     27 )\n\nFile ~/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/isofit/utils/apply_oe.py:330, in apply_oe(input_radiance, input_loc, input_obs, working_directory, sensor, surface_path, copy_input_files, modtran_path, wavelength_path, surface_category, surface_class_file, classify_multisurface, aerosol_climatology_path, rdn_factors_path, atmosphere_type, channelized_uncertainty_path, instrument_noise_path, dn_uncertainty_file, model_discrepancy_path, lut_config_file, multiple_restarts, logging_level, log_file, n_cores, presolve, empirical_line, analytical_line, ray_temp_dir, emulator_base, segmentation_size, num_neighbors, atm_sigma, pressure_elevation, prebuilt_lut, no_min_lut_spacing, inversion_windows, config_only, interpolate_bad_rdn, interpolate_inplace, skyview_factor, resources, retrieve_co2, eof_path, terrain_style)\n    325         logging.error(\n    326             \"The resources.jsonl will only be generated when a log file is also set\"\n    327         )\n    329 logging.info(\"Checking input data files...\")\n--&gt; 330 rdn_dataset = envi.open(envi_header(input_radiance))\n    331 rdn_size = (rdn_dataset.shape[0], rdn_dataset.shape[1])\n    332 del rdn_dataset\n\nFile ~/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/spectral/io/envi.py:304, in open(file, image)\n    272 def open(file, image=None):\n    273     '''\n    274     Opens an image or spectral library with an associated ENVI HDR header file.\n    275 \n   (...)    301     Capitalized versions of the file extensions are also searched.\n    302     '''\n--&gt; 304     header_path = find_file_path(file)\n    305     h = read_envi_header(header_path)\n    306     check_compatibility(h)\n\nFile ~/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/spectral/io/spyfile.py:122, in find_file_path(filename)\n    118 if not pathname:\n    119     msg = 'Unable to locate file \"%s\". If the file exists, ' \\\n    120       'use its full path or place its directory in the ' \\\n    121       'SPECTRAL_DATA environment variable.' % filename\n--&gt; 122     raise FileNotFoundError(msg)\n    123 return pathname\n\nFileNotFoundError: Unable to locate file \"/home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/medium/ang20170323t202244_rdn_7000-7010.hdr\". If the file exists, use its full path or place its directory in the SPECTRAL_DATA environment variable.</pre> <p>We can visualize what the segmentation is doing by leveraging the <code>isofit reconstruct_subs</code> CLI command:</p> <pre>EX=$(isofit path examples)/image_cube/medium isofit reconstruct_subs \\\n    $EX/input/ang20170323t202244_subs_rdn \\\n    $EX/input/ang20170323t202244_subs_recon_rdn \\\n    $EX/output/ang20170323t202244_lbl\n\nEX=$(isofit path examples)/image_cube/medium isofit reconstruct_subs \\\n    $EX/input/ang20170323t202244_subs_loc \\\n    $EX/input/ang20170323t202244_subs_recon_loc \\\n    $EX/output/ang20170323t202244_lbl\n\nEX=$(isofit path examples)/image_cube/medium isofit reconstruct_subs \\\n    $EX/input/ang20170323t202244_subs_obs \\\n    $EX/input/ang20170323t202244_subs_recon_obs \\\n    $EX/output/ang20170323t202244_lbl\n</pre> In\u00a0[10]: Copied! <pre>from isofit.utils.reconstruct import reconstruct_subs\n\nfor product in (\"rdn\", \"loc\", \"obs\"):\n    reconstruct_subs(\n        input_subs_path  = str(env.path(\"examples\", \"image_cube\", \"medium\", \"input\", f\"ang20170323t202244_subs_{product}\")),\n        output_path      = str(env.path(\"examples\", \"image_cube\", \"medium\", \"input\", f\"ang20170323t202244_subs_recon_{product}\")),\n        lbl_working_path = str(env.path(\"examples\", \"image_cube\", \"medium\", \"output\", \"ang20170323t202244_lbl\")),\n    )\n</pre> from isofit.utils.reconstruct import reconstruct_subs  for product in (\"rdn\", \"loc\", \"obs\"):     reconstruct_subs(         input_subs_path  = str(env.path(\"examples\", \"image_cube\", \"medium\", \"input\", f\"ang20170323t202244_subs_{product}\")),         output_path      = str(env.path(\"examples\", \"image_cube\", \"medium\", \"input\", f\"ang20170323t202244_subs_recon_{product}\")),         lbl_working_path = str(env.path(\"examples\", \"image_cube\", \"medium\", \"output\", \"ang20170323t202244_lbl\")),     ) <pre>ERROR:2026-02-24,21:02:15 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/medium/input/ang20170323t202244_subs_rdn\n</pre> <pre>ERROR:2026-02-24,21:02:15 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/medium/input/ang20170323t202244_subs_recon_rdn\n</pre> <pre>ERROR:2026-02-24,21:02:15 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/medium/output/ang20170323t202244_lbl\n</pre> <pre>\n---------------------------------------------------------------------------\nFileNotFoundError                         Traceback (most recent call last)\nCell In[10], line 4\n      1 from isofit.utils.reconstruct import reconstruct_subs\n      3 for product in (\"rdn\", \"loc\", \"obs\"):\n----&gt; 4     reconstruct_subs(\n      5         input_subs_path  = str(env.path(\"examples\", \"image_cube\", \"medium\", \"input\", f\"ang20170323t202244_subs_{product}\")),\n      6         output_path      = str(env.path(\"examples\", \"image_cube\", \"medium\", \"input\", f\"ang20170323t202244_subs_recon_{product}\")),\n      7         lbl_working_path = str(env.path(\"examples\", \"image_cube\", \"medium\", \"output\", \"ang20170323t202244_lbl\")),\n      8     )\n\nFile ~/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/isofit/utils/reconstruct.py:44, in reconstruct_subs(input_subs_path, output_path, lbl_working_path)\n     27 \"\"\"Helper function to take the flat array that the superpixel\n     28 algorithms work with and turn them into images at the full resolution\n     29 of the input/output file. They will have the full array-resolution,\n   (...)     41     None\n     42 \"\"\"\n     43 # Load the input data\n---&gt; 44 subs_input = envi.open(envi_header(input_subs_path))\n     45 subs_input_ar = np.squeeze(subs_input.open_memmap(interleave=\"bip\"))\n     47 lbl = envi.open(envi_header(lbl_working_path))\n\nFile ~/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/spectral/io/envi.py:304, in open(file, image)\n    272 def open(file, image=None):\n    273     '''\n    274     Opens an image or spectral library with an associated ENVI HDR header file.\n    275 \n   (...)    301     Capitalized versions of the file extensions are also searched.\n    302     '''\n--&gt; 304     header_path = find_file_path(file)\n    305     h = read_envi_header(header_path)\n    306     check_compatibility(h)\n\nFile ~/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/spectral/io/spyfile.py:122, in find_file_path(filename)\n    118 if not pathname:\n    119     msg = 'Unable to locate file \"%s\". If the file exists, ' \\\n    120       'use its full path or place its directory in the ' \\\n    121       'SPECTRAL_DATA environment variable.' % filename\n--&gt; 122     raise FileNotFoundError(msg)\n    123 return pathname\n\nFileNotFoundError: Unable to locate file \"/home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/medium/input/ang20170323t202244_subs_rdn.hdr\". If the file exists, use its full path or place its directory in the SPECTRAL_DATA environment variable.</pre> <p>Visualizing the input data:</p> In\u00a0[11]: Copied! <pre># Plotting the input data\nrdn_path = env.path(\"examples\", \"image_cube\", \"medium\", \"ang20170323t202244_rdn_7000-7010\")\nloc_path = env.path(\"examples\", \"image_cube\", \"medium\", \"ang20170323t202244_loc_7000-7010\")\nobs_path = env.path(\"examples\", \"image_cube\", \"medium\", \"ang20170323t202244_obs_7000-7010\")\n\nsubs_rdn_path = env.path(\"examples\", \"image_cube\", \"medium\", \"input\", \"ang20170323t202244_subs_recon_rdn\")\nsubs_loc_path = env.path(\"examples\", \"image_cube\", \"medium\", \"input\", \"ang20170323t202244_subs_recon_loc\")\nsubs_obs_path = env.path(\"examples\", \"image_cube\", \"medium\", \"input\", \"ang20170323t202244_subs_recon_obs\")\n\nrdn = envi.open(envi_header(str(rdn_path)))\nloc = envi.open(envi_header(str(loc_path)))\nobs = envi.open(envi_header(str(obs_path)))\n\nsubs_rdn = envi.open(envi_header(str(subs_rdn_path)))\nsubs_loc = envi.open(envi_header(str(subs_loc_path)))\nsubs_obs = envi.open(envi_header(str(subs_obs_path)))\n\nrdn_im = rdn.open_memmap(interleave='bip')\nloc_im = loc.open_memmap(interleave='bip')\nobs_im = obs.open_memmap(interleave='bip')\n\nsubs_rdn_im = subs_rdn.open_memmap(interleave='bip')\nsubs_loc_im = subs_loc.open_memmap(interleave='bip')\nsubs_obs_im = subs_obs.open_memmap(interleave='bip')\n\nfig, axs = plt.subplots(2, 3, sharex=True, sharey=True, figsize=(10, 10))\naxs = np.ravel(axs)\n\naxs[0].imshow(normalize(rdn_im[0:400, :, bands], 0, 15))\naxs[1].imshow(loc[0:400, :, 0])\naxs[2].imshow(obs[0:400, :, 4])\n\naxs[3].imshow(normalize(subs_rdn_im[0:400, :, bands], 0, 15))\naxs[4].imshow(subs_loc[0:400, :, 0])\naxs[5].imshow(subs_obs[0:400, :, 4])\n\naxs[0].set_title('Radiance')\naxs[1].set_title('Longitude')\naxs[2].set_title('Elevation')\n\naxs[0].set_ylabel('Full resolution')\naxs[3].set_ylabel('Superpixel resolution')\nplt.show()\n</pre> # Plotting the input data rdn_path = env.path(\"examples\", \"image_cube\", \"medium\", \"ang20170323t202244_rdn_7000-7010\") loc_path = env.path(\"examples\", \"image_cube\", \"medium\", \"ang20170323t202244_loc_7000-7010\") obs_path = env.path(\"examples\", \"image_cube\", \"medium\", \"ang20170323t202244_obs_7000-7010\")  subs_rdn_path = env.path(\"examples\", \"image_cube\", \"medium\", \"input\", \"ang20170323t202244_subs_recon_rdn\") subs_loc_path = env.path(\"examples\", \"image_cube\", \"medium\", \"input\", \"ang20170323t202244_subs_recon_loc\") subs_obs_path = env.path(\"examples\", \"image_cube\", \"medium\", \"input\", \"ang20170323t202244_subs_recon_obs\")  rdn = envi.open(envi_header(str(rdn_path))) loc = envi.open(envi_header(str(loc_path))) obs = envi.open(envi_header(str(obs_path)))  subs_rdn = envi.open(envi_header(str(subs_rdn_path))) subs_loc = envi.open(envi_header(str(subs_loc_path))) subs_obs = envi.open(envi_header(str(subs_obs_path)))  rdn_im = rdn.open_memmap(interleave='bip') loc_im = loc.open_memmap(interleave='bip') obs_im = obs.open_memmap(interleave='bip')  subs_rdn_im = subs_rdn.open_memmap(interleave='bip') subs_loc_im = subs_loc.open_memmap(interleave='bip') subs_obs_im = subs_obs.open_memmap(interleave='bip')  fig, axs = plt.subplots(2, 3, sharex=True, sharey=True, figsize=(10, 10)) axs = np.ravel(axs)  axs[0].imshow(normalize(rdn_im[0:400, :, bands], 0, 15)) axs[1].imshow(loc[0:400, :, 0]) axs[2].imshow(obs[0:400, :, 4])  axs[3].imshow(normalize(subs_rdn_im[0:400, :, bands], 0, 15)) axs[4].imshow(subs_loc[0:400, :, 0]) axs[5].imshow(subs_obs[0:400, :, 4])  axs[0].set_title('Radiance') axs[1].set_title('Longitude') axs[2].set_title('Elevation')  axs[0].set_ylabel('Full resolution') axs[3].set_ylabel('Superpixel resolution') plt.show() <pre>ERROR:2026-02-24,21:02:15 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/medium/ang20170323t202244_rdn_7000-7010\n</pre> <pre>ERROR:2026-02-24,21:02:15 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/medium/ang20170323t202244_loc_7000-7010\n</pre> <pre>ERROR:2026-02-24,21:02:15 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/medium/ang20170323t202244_obs_7000-7010\n</pre> <pre>ERROR:2026-02-24,21:02:15 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/medium/input/ang20170323t202244_subs_recon_rdn\n</pre> <pre>ERROR:2026-02-24,21:02:15 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/medium/input/ang20170323t202244_subs_recon_loc\n</pre> <pre>ERROR:2026-02-24,21:02:15 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/medium/input/ang20170323t202244_subs_recon_obs\n</pre> <pre>\n---------------------------------------------------------------------------\nFileNotFoundError                         Traceback (most recent call last)\nCell In[11], line 10\n      7 subs_loc_path = env.path(\"examples\", \"image_cube\", \"medium\", \"input\", \"ang20170323t202244_subs_recon_loc\")\n      8 subs_obs_path = env.path(\"examples\", \"image_cube\", \"medium\", \"input\", \"ang20170323t202244_subs_recon_obs\")\n---&gt; 10 rdn = envi.open(envi_header(str(rdn_path)))\n     11 loc = envi.open(envi_header(str(loc_path)))\n     12 obs = envi.open(envi_header(str(obs_path)))\n\nFile ~/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/spectral/io/envi.py:304, in open(file, image)\n    272 def open(file, image=None):\n    273     '''\n    274     Opens an image or spectral library with an associated ENVI HDR header file.\n    275 \n   (...)    301     Capitalized versions of the file extensions are also searched.\n    302     '''\n--&gt; 304     header_path = find_file_path(file)\n    305     h = read_envi_header(header_path)\n    306     check_compatibility(h)\n\nFile ~/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/spectral/io/spyfile.py:122, in find_file_path(filename)\n    118 if not pathname:\n    119     msg = 'Unable to locate file \"%s\". If the file exists, ' \\\n    120       'use its full path or place its directory in the ' \\\n    121       'SPECTRAL_DATA environment variable.' % filename\n--&gt; 122     raise FileNotFoundError(msg)\n    123 return pathname\n\nFileNotFoundError: Unable to locate file \"/home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/medium/ang20170323t202244_rdn_7000-7010.hdr\". If the file exists, use its full path or place its directory in the SPECTRAL_DATA environment variable.</pre> <p>We can examine the results from Apply OE after the OE solutions on the superpixels:</p> In\u00a0[12]: Copied! <pre>wl = np.array(rdn.metadata['wavelength']).astype(float)\n\nstate_path = str(env.path(\"examples\", \"image_cube\", \"medium\", \"output\", \"ang20170323t202244_recon_subs_state\"))\nreconstruct_subs(\n    input_subs_path  = str(env.path(\"examples\", \"image_cube\", \"medium\", \"output\", \"ang20170323t202244_subs_state\")),\n    output_path      = state_path,\n    lbl_working_path = str(env.path(\"examples\", \"image_cube\", \"medium\", \"output\", \"ang20170323t202244_lbl\")),\n)\n\nstate = envi.open(envi_header(str(state_path)))\nstate_im = state.open_memmap(interleave='bip')\n\nfig, axs = plt.subplots(1, 4, sharex=True, sharey=True, figsize=(8, 5), tight_layout=True)\naxs[0].imshow(normalize(rdn_im[0:400, :, bands], 0, 15))\naxs[1].imshow(normalize(state_im[0:400, :, bands], 0, 0.25))\naod = axs[2].imshow(state_im[0:400, :, -2])\nh2o = axs[3].imshow(state_im[0:400, :, -1])\n\nplt.colorbar(aod)\nplt.colorbar(h2o)\n\naxs[0].set_title('Radiance')\naxs[1].set_title('Reflectance')\naxs[2].set_title('AOD')\naxs[3].set_title('H2O')\nplt.show()\n</pre> wl = np.array(rdn.metadata['wavelength']).astype(float)  state_path = str(env.path(\"examples\", \"image_cube\", \"medium\", \"output\", \"ang20170323t202244_recon_subs_state\")) reconstruct_subs(     input_subs_path  = str(env.path(\"examples\", \"image_cube\", \"medium\", \"output\", \"ang20170323t202244_subs_state\")),     output_path      = state_path,     lbl_working_path = str(env.path(\"examples\", \"image_cube\", \"medium\", \"output\", \"ang20170323t202244_lbl\")), )  state = envi.open(envi_header(str(state_path))) state_im = state.open_memmap(interleave='bip')  fig, axs = plt.subplots(1, 4, sharex=True, sharey=True, figsize=(8, 5), tight_layout=True) axs[0].imshow(normalize(rdn_im[0:400, :, bands], 0, 15)) axs[1].imshow(normalize(state_im[0:400, :, bands], 0, 0.25)) aod = axs[2].imshow(state_im[0:400, :, -2]) h2o = axs[3].imshow(state_im[0:400, :, -1])  plt.colorbar(aod) plt.colorbar(h2o)  axs[0].set_title('Radiance') axs[1].set_title('Reflectance') axs[2].set_title('AOD') axs[3].set_title('H2O') plt.show() <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[12], line 1\n----&gt; 1 wl = np.array(rdn.metadata['wavelength']).astype(float)\n      3 state_path = str(env.path(\"examples\", \"image_cube\", \"medium\", \"output\", \"ang20170323t202244_recon_subs_state\"))\n      4 reconstruct_subs(\n      5     input_subs_path  = str(env.path(\"examples\", \"image_cube\", \"medium\", \"output\", \"ang20170323t202244_subs_state\")),\n      6     output_path      = state_path,\n      7     lbl_working_path = str(env.path(\"examples\", \"image_cube\", \"medium\", \"output\", \"ang20170323t202244_lbl\")),\n      8 )\n\nNameError: name 'rdn' is not defined</pre> <p>Finally, we can examine the final results at the end of the anlaytical line algorithm:</p> In\u00a0[13]: Copied! <pre>rfl_path = env.path(\"examples\", \"image_cube\", \"medium\", \"output\", \"ang20170323t202244_rfl\")\natm_path = env.path(\"examples\", \"image_cube\", \"medium\", \"output\", \"ang20170323t202244_atm_interp\")\n\nrfl  = envi.open(envi_header(str(rfl_path)))\natm  = envi.open(envi_header(str(atm_path)))\n\nrfl_im = rfl.open_memmap(interleave='bip')\natm_im = atm.open_memmap(interleave='bip')\n\n\nfig, axs = plt.subplots(1, 4, sharex=True, sharey=True, figsize=(8, 5), tight_layout=True)\naxs[0].imshow(normalize(rdn_im[0:400, :, bands], 0, 15))\naxs[1].imshow(normalize(rfl_im[0:400, :, bands], 0, 0.25))\naod = axs[2].imshow(atm_im[0:400, :, -2])\nh2o = axs[3].imshow(atm_im[0:400, :, -1])\n\nplt.colorbar(aod)\nplt.colorbar(h2o)\n\naxs[0].set_title('Radiance')\naxs[1].set_title('Reflectance')\naxs[2].set_title('AOD')\naxs[3].set_title('H2O')\nplt.show()\n</pre> rfl_path = env.path(\"examples\", \"image_cube\", \"medium\", \"output\", \"ang20170323t202244_rfl\") atm_path = env.path(\"examples\", \"image_cube\", \"medium\", \"output\", \"ang20170323t202244_atm_interp\")  rfl  = envi.open(envi_header(str(rfl_path))) atm  = envi.open(envi_header(str(atm_path)))  rfl_im = rfl.open_memmap(interleave='bip') atm_im = atm.open_memmap(interleave='bip')   fig, axs = plt.subplots(1, 4, sharex=True, sharey=True, figsize=(8, 5), tight_layout=True) axs[0].imshow(normalize(rdn_im[0:400, :, bands], 0, 15)) axs[1].imshow(normalize(rfl_im[0:400, :, bands], 0, 0.25)) aod = axs[2].imshow(atm_im[0:400, :, -2]) h2o = axs[3].imshow(atm_im[0:400, :, -1])  plt.colorbar(aod) plt.colorbar(h2o)  axs[0].set_title('Radiance') axs[1].set_title('Reflectance') axs[2].set_title('AOD') axs[3].set_title('H2O') plt.show() <pre>ERROR:2026-02-24,21:02:15 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/medium/output/ang20170323t202244_rfl\n</pre> <pre>ERROR:2026-02-24,21:02:15 || ini.py:path() | The following path does not exist, please verify your installation environment: /home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/medium/output/ang20170323t202244_atm_interp\n</pre> <pre>\n---------------------------------------------------------------------------\nFileNotFoundError                         Traceback (most recent call last)\nCell In[13], line 4\n      1 rfl_path = env.path(\"examples\", \"image_cube\", \"medium\", \"output\", \"ang20170323t202244_rfl\")\n      2 atm_path = env.path(\"examples\", \"image_cube\", \"medium\", \"output\", \"ang20170323t202244_atm_interp\")\n----&gt; 4 rfl  = envi.open(envi_header(str(rfl_path)))\n      5 atm  = envi.open(envi_header(str(atm_path)))\n      7 rfl_im = rfl.open_memmap(interleave='bip')\n\nFile ~/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/spectral/io/envi.py:304, in open(file, image)\n    272 def open(file, image=None):\n    273     '''\n    274     Opens an image or spectral library with an associated ENVI HDR header file.\n    275 \n   (...)    301     Capitalized versions of the file extensions are also searched.\n    302     '''\n--&gt; 304     header_path = find_file_path(file)\n    305     h = read_envi_header(header_path)\n    306     check_compatibility(h)\n\nFile ~/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/spectral/io/spyfile.py:122, in find_file_path(filename)\n    118 if not pathname:\n    119     msg = 'Unable to locate file \"%s\". If the file exists, ' \\\n    120       'use its full path or place its directory in the ' \\\n    121       'SPECTRAL_DATA environment variable.' % filename\n--&gt; 122     raise FileNotFoundError(msg)\n    123 return pathname\n\nFileNotFoundError: Unable to locate file \"/home/runner/work/isofit-tutorials/isofit-tutorials/image_cube/medium/output/ang20170323t202244_rfl.hdr\". If the file exists, use its full path or place its directory in the SPECTRAL_DATA environment variable.</pre>"},{"location":"notebooks/apply_oe/#apply-oe","title":"Apply OE\u00b6","text":"<p>Apply OE is the built-in end-to-end atmospheric correction pipeline, and is the easiest way to run Isofit. Apply OE is run via a command line interface (CLI) tool accessed with a terminal call:</p> <pre>isofit apply_oe --help\n</pre> <p>The function docstring is printed when this command is run within a terminal window, and acts as a guide for how to run the function.</p>"},{"location":"notebooks/apply_oe/#how-do-you-run-apply-oe","title":"How do you run Apply OE?\u00b6","text":"<p>The script is run via the CLI. For example:</p> <p><code>IC=$(isofit path examples)/image_cube/small</code> sets the environment variable <code>IC</code> to the output of the command <code>isofit path examples/image_cube/small</code>. This is just used to reuse the same output for multiple arguments. Depending on the user's isofit installation environment, this path may vary. This command ensures the correct path is retrieved</p> <pre>  IC=$(isofit path examples)/image_cube/small EX=$(isofit path examples)/image_cube/small \\\n  isofit apply_oe \\\n  $IC/ang20170323t202244_rdn_7000-7010 \\\n  $IC/ang20170323t202244_loc_7000-7010 \\\n  $IC/ang20170323t202244_obs_7000-7010 \\\n  $EX \\\n  ang \\\n  --surface_path $EX/configs/surface.json \\\n  --emulator_base $(isofit path srtmnet --key file) \\\n  --n_cores 10 \\\n  --presolve \\\n</pre>"},{"location":"notebooks/apply_oe/#the-analytical-line","title":"The Analytical Line\u00b6","text":"<p>In the example above, we ran Isofit using the full optimal estimation (OE) on each pixel independently. Computationally, this amounts to iterating through each row-column pair to solve for the full state-vector (427 variables in the above case). However for large images, this demands long run-times, and ignores the principle that some state-vector elements, namely the atmospheric variables like AOD and H2O, should not vary from one pixel to another, but rather should be spatially smooth, and only vary over multi-pixel length scales Link to the relevent paper.</p> <p>The analytical line and empirical line algorithms leverage the assumption of a spatially smooth atmosphere to decrease run times by a factor of 10. Currently, we suggest using the analytical line algorithm and not the empirical line algorithm.</p>"},{"location":"notebooks/neon/","title":"NEON","text":"In\u00a0[1]: Copied! <pre># Jupyter magics\n%matplotlib inline\n\n# Builtin\nimport os\nimport shutil\nfrom pathlib import Path\nfrom types import SimpleNamespace\n\n# External\nimport matplotlib.pyplot  as plt\nimport matplotlib.patches as patches\nimport numpy as np\nfrom spectral.io import envi\n\n# Internal\nimport isofit\nfrom isofit.data import env\nfrom isofit.utils.apply_oe import apply_oe\nfrom isofit.utils.surface_model import surface_model\n</pre> # Jupyter magics %matplotlib inline  # Builtin import os import shutil from pathlib import Path from types import SimpleNamespace  # External import matplotlib.pyplot  as plt import matplotlib.patches as patches import numpy as np from spectral.io import envi  # Internal import isofit from isofit.data import env from isofit.utils.apply_oe import apply_oe from isofit.utils.surface_model import surface_model In\u00a0[2]: Copied! <pre># Below are the default values for the ISOFIT environment. Change these if your environment differs\n\nenv.load('~/.isofit/isofit.ini') # Ini file to load\nenv.changeSection('DEFAULT')     # Section of the ini to use\n# env.changeBase('~./isofit')      # Base path for ISOFIT extras (data, examples, etc)\n# env.changePath('srtmnet', '/path/to/sRTMnet_v120.h5') # Overwrite the path to sRTMnet - copy this line for other products such as sixs if in non-default locations\n\nprint('Using environment paths:')\nfor key, path in env.items():\n    print(f\"- {key} = {path}\")\n</pre> # Below are the default values for the ISOFIT environment. Change these if your environment differs  env.load('~/.isofit/isofit.ini') # Ini file to load env.changeSection('DEFAULT')     # Section of the ini to use # env.changeBase('~./isofit')      # Base path for ISOFIT extras (data, examples, etc) # env.changePath('srtmnet', '/path/to/sRTMnet_v120.h5') # Overwrite the path to sRTMnet - copy this line for other products such as sixs if in non-default locations  print('Using environment paths:') for key, path in env.items():     print(f\"- {key} = {path}\") <pre>Using environment paths:\n- data = /home/runner/work/isofit-tutorials/data\n- examples = /home/runner/work/isofit-tutorials/isofit-tutorials\n- imagecube = /home/runner/work/isofit-tutorials/imagecube\n- srtmnet = /home/runner/work/isofit-tutorials/srtmnet\n- sixs = /home/runner/work/isofit-tutorials/sixs\n- surface = /home/runner/work/isofit-tutorials/surface\n- plots = /home/runner/work/isofit-tutorials/plots\n- libradtran = /home/runner/work/isofit-tutorials/libradtran\n- srtmnet.file = sRTMnet_v120.h5\n- srtmnet.aux = sRTMnet_v120_aux.npz\n- libradtran.version = libRadtran-2.0.6\n</pre> In\u00a0[3]: Copied! <pre># Extract the image locations of each point of interest (POI)\n# These are defined in the NEON report as pixel locations, so we round here to convert to indices\nreport = {}\nreport['173647'] = {     # Upp L Y  | Low R Y  | Upp L X | Low R X\n    'WhiteTarp': np.round([2224.9626, 2230.9771, 316.0078, 324.9385,]).astype(int),\n    'BlackTarp': np.round([2224.9626, 2231.0032, 328.0086, 333.9731,]).astype(int),\n    'Veg'      : np.round([2245.0381, 2258.8103, 343.9006, 346.9423,]).astype(int),\n    'RoadEW'   : np.round([2214.9905, 2216.9978, 348.9902, 373.0080,]).astype(int),\n    'RoadNS'   : np.round([2205.9580, 2225.9612, 357.9536, 359.9608,]).astype(int)\n}\nreport['174150'] = {     # Upp L Y | Low R Y | Upp L X  | Low R X\n    'WhiteTarp': np.round([653.9626, 659.9771, 3143.0078, 3151.9385]).astype(int),\n    'BlackTarp': np.round([653.9626, 660.0032, 3155.0086, 3160.9731]).astype(int),\n    'Veg'      : np.round([674.0381, 687.8103, 3170.9006, 3173.9423]).astype(int),\n    'RoadEW'   : np.round([643.9905, 645.9978, 3175.9902, 3200.0080]).astype(int),\n    'RoadNS'   : np.round([634.9580, 654.9612, 3184.9536, 3186.9608]).astype(int)\n}\n\n# Which NEON date to process - change this to process a different date\nneon_id  = list(report.keys())[0]\nneon_str = f\"NIS01_20210403_{neon_id}\"\n\n# Select the locations from the neon id -- roi == Regions of Interest\nroi = report[neon_id]\n</pre> # Extract the image locations of each point of interest (POI) # These are defined in the NEON report as pixel locations, so we round here to convert to indices report = {} report['173647'] = {     # Upp L Y  | Low R Y  | Upp L X | Low R X     'WhiteTarp': np.round([2224.9626, 2230.9771, 316.0078, 324.9385,]).astype(int),     'BlackTarp': np.round([2224.9626, 2231.0032, 328.0086, 333.9731,]).astype(int),     'Veg'      : np.round([2245.0381, 2258.8103, 343.9006, 346.9423,]).astype(int),     'RoadEW'   : np.round([2214.9905, 2216.9978, 348.9902, 373.0080,]).astype(int),     'RoadNS'   : np.round([2205.9580, 2225.9612, 357.9536, 359.9608,]).astype(int) } report['174150'] = {     # Upp L Y | Low R Y | Upp L X  | Low R X     'WhiteTarp': np.round([653.9626, 659.9771, 3143.0078, 3151.9385]).astype(int),     'BlackTarp': np.round([653.9626, 660.0032, 3155.0086, 3160.9731]).astype(int),     'Veg'      : np.round([674.0381, 687.8103, 3170.9006, 3173.9423]).astype(int),     'RoadEW'   : np.round([643.9905, 645.9978, 3175.9902, 3200.0080]).astype(int),     'RoadNS'   : np.round([634.9580, 654.9612, 3184.9536, 3186.9608]).astype(int) }  # Which NEON date to process - change this to process a different date neon_id  = list(report.keys())[0] neon_str = f\"NIS01_20210403_{neon_id}\"  # Select the locations from the neon id -- roi == Regions of Interest roi = report[neon_id] In\u00a0[4]: Copied! <pre># Set the paths for this tutorial\nbase = Path(env.path('examples', 'NEON'))\nraws = base / 'data'\ndata = base / 'neon_subset'\n\npaths = SimpleNamespace(\n    rdn = str(data / f'{neon_str}_rdn_ort'),\n    loc = str(data / f'{neon_str}_loc_ort'),\n    obs = str(data / f'{neon_str}_obs_ort'),\n    insitu = raws,\n    output = base / 'output',\n    working = base / f'output/NIS01_20210403_{neon_id}',\n    surface = str(base / 'output/surface.mat'),\n    surface_config = env.path('examples', '20171108_Pasadena', 'configs', 'ang20171108t184227_surface.json')\n)\n\npaths.output.mkdir(exist_ok=True, parents=True)\n</pre> # Set the paths for this tutorial base = Path(env.path('examples', 'NEON')) raws = base / 'data' data = base / 'neon_subset'  paths = SimpleNamespace(     rdn = str(data / f'{neon_str}_rdn_ort'),     loc = str(data / f'{neon_str}_loc_ort'),     obs = str(data / f'{neon_str}_obs_ort'),     insitu = raws,     output = base / 'output',     working = base / f'output/NIS01_20210403_{neon_id}',     surface = str(base / 'output/surface.mat'),     surface_config = env.path('examples', '20171108_Pasadena', 'configs', 'ang20171108t184227_surface.json') )  paths.output.mkdir(exist_ok=True, parents=True) In\u00a0[5]: Copied! <pre># If you are missing either an OBS file or a LOC file, use these to create faked versions based off the radiance file\n# This should not be needed if using the provided data\n# Using this may cause the below plots to not generate the same results\n\n# from isotuts import neon_utils\n\n# paths.obs = neon_utils.fakeOBS(\n    # f\"{paths.rdn}.hdr\",\n    # sea = 153.4481201171875,\n    # sez = 178.3806858062744,\n    # soa = 39.8218994140625,\n    # soz = 39.8218994140625,\n    # slope = 31.813383102416992\n# )[:-4] # Remove the .hdr extension from the return\n# paths.loc = neon_utils.fakeLOC(\n#     rdn = f\"{paths.rdn}.hdr\",\n#     lon = -105.237000,\n#     lat = 40.125000,\n#     elv = 1689.0\n# )[:-4]\n</pre> # If you are missing either an OBS file or a LOC file, use these to create faked versions based off the radiance file # This should not be needed if using the provided data # Using this may cause the below plots to not generate the same results  # from isotuts import neon_utils  # paths.obs = neon_utils.fakeOBS(     # f\"{paths.rdn}.hdr\",     # sea = 153.4481201171875,     # sez = 178.3806858062744,     # soa = 39.8218994140625,     # soz = 39.8218994140625,     # slope = 31.813383102416992 # )[:-4] # Remove the .hdr extension from the return # paths.loc = neon_utils.fakeLOC( #     rdn = f\"{paths.rdn}.hdr\", #     lon = -105.237000, #     lat = 40.125000, #     elv = 1689.0 # )[:-4] In\u00a0[6]: Copied! <pre># First build a surface model\nsurface_model(\n    config_path = paths.surface_config,\n    output_path = paths.surface,\n    wavelength_path = f\"{paths.rdn}.hdr\"\n)\n</pre> # First build a surface model surface_model(     config_path = paths.surface_config,     output_path = paths.surface,     wavelength_path = f\"{paths.rdn}.hdr\" ) <pre>0 ['/home/runner/work/isofit-tutorials/data/reflectance/surface_model_ucsb']\n</pre> <pre>1 ['/home/runner/work/isofit-tutorials/data/reflectance/surface_model_ucsb']\n</pre> <pre>2 ['/home/runner/work/isofit-tutorials/data/reflectance/surface_model_ucsb']\n3 ['/home/runner/work/isofit-tutorials/data/reflectance/surface_model_ucsb']\n</pre> <pre>4 ['/home/runner/work/isofit-tutorials/data/reflectance/surface_model_ucsb']\n5 ['/home/runner/work/isofit-tutorials/data/reflectance/surface_model_ucsb']\n</pre> <pre>6 ['/home/runner/work/isofit-tutorials/data/reflectance/surface_model_ucsb']\n7 ['/home/runner/work/isofit-tutorials/data/reflectance/surface_model_ucsb']\n</pre> In\u00a0[7]: Copied! <pre># For reference, all of the available parameters to the apply_oe script\nprint(apply_oe.__doc__)\n</pre> # For reference, all of the available parameters to the apply_oe script print(apply_oe.__doc__) <pre>\nApplies OE over a flightline using a radiative transfer engine. This executes\nISOFIT in a generalized way, accounting for the types of variation that might be\nconsidered typical.\n\nObservation (obs) and location (loc) files are used to determine appropriate\ngeometry lookup tables and provide a heuristic means of determining atmospheric\nwater ranges.\n\nParameters\n----------\ninput_radiance : str\n    Radiance data cube. Expected to be ENVI format\ninput_loc : str\n    Location data cube of shape (Lon, Lat, Elevation). Expected to be ENVI format\ninput_obs : str\n    Observation data cube of shape:\n        (path length, to-sensor azimuth, to-sensor zenith,\n        to-sun azimuth, to-sun zenith, phase,\n        slope, aspect, cosine i, UTC time)\n    Expected to be ENVI format\nworking_directory : str\n    Directory to stage multiple outputs, will contain subdirectories\nsensor : str\n    The sensor used for acquisition, will be used to set noise and datetime\n    settings\nsurface_path : str\n    Path to surface model or json dict of surface model configuration\ncopy_input_files : bool, default=False\n    Flag to choose to copy input_radiance, input_loc, and input_obs locally into\n    the working_directory\nmodtran_path : str, default=None\n    Location of MODTRAN utility. Alternately set with `MODTRAN_DIR` environment\n    variable\nwavelength_path : str, default=None\n    Location to get wavelength information from, if not specified the radiance\n    header will be used\nsurface_category : str, default=\"multicomponent_surface\"\n    The type of ISOFIT surface priors to use.  Default is multicomponent_surface\naerosol_climatology_path : str, default=None\n    Specific aerosol climatology information to use in MODTRAN\nrdn_factors_path : str, default=None\n    Specify a radiometric correction factor, if desired\natmosphere_type : str, default=\"ATM_MIDLAT_SUMMER\"\n    Atmospheric profile to be used for MODTRAN simulations.  Unused for other\n    radiative transfer models.\nchannelized_uncertainty_path : str, default=None\n    Path to a wavelength-specific channelized uncertainty file - used to augment Sy in the OE formalism\ninstrument_noise_path : str, default=None\n    Path to a wavelength-specific instrument noise file, used to derive per-wavelength NEDL / SNR\ndn_uncertainty_file:  str, default=None\n    Path to a linearity .mat file to augment S matrix with linearity uncertainty\nmodel_discrepancy_path : str, default=None\n    Modifies S_eps in the OE formalism as the Gamma additive term, as:\n    S_eps = Sy + Kb.dot(self.Sb).dot(Kb.T) + Gamma\nlut_config_file : str, default=None\n    Path to a look up table configuration file, which will override defaults\n    choices\nmultiple_restarts : bool, default=False\n    Use multiple initial starting poitns for each OE ptimization run, using\n    the corners of the atmospheric variables as starting points.  This gives\n    a more robust, albeit more expensive, solution.\nlogging_level : str, default=\"INFO\"\n    Logging level with which to run ISOFIT\nlog_file : str, default=None\n    File path to write ISOFIT logs to\nn_cores : int, default=1\n    Number of cores to run ISOFIT with. Substantial parallelism is available, and\n    full runs will be very slow in serial. Suggested to max this out on the\n    available system\npresolve : int, default=False\n    Flag to use a presolve mode to estimate the available atmospheric water range.\n    Runs a preliminary inversion over the image with a 1-D LUT of water vapor, and\n    uses the resulting range (slightly expanded) to bound determine the full LUT.\n    Advisable to only use with small cubes or in concert with the empirical_line\n    setting, or a significant speed penalty will be incurred\nempirical_line : bool, default=False\n    Use an empirical line interpolation to run full inversions over only a subset\n    of pixels, determined using a SLIC superpixel segmentation, and use a KDTREE of\n    local solutions to interpolate radiance-&gt;reflectance. Generally a good option\n    if not trying to analyze the atmospheric state at fine scale resolution.\n    Mutually exclusive with analytical_line\nanalytical_line : bool, default=False\n    Use an analytical solution to the fixed atmospheric state to solve for each\n    pixel.  Starts by running a full OE retrieval on each SLIC superpixel, then\n    interpolates the atmospheric state to each pixel, and closes with the\n    analytical solution.\n    Mutually exclusive with empirical_line\nray_temp_dir : str, default=\"/tmp/ray\"\n    Location of temporary directory for ray parallelization engine\nemulator_base : str, default=None\n    Location of emulator base path. Point this at the 3C or 6C .h5 files.\n    sRTMnet to use the emulator instead of MODTRAN. An additional file with the\n    same basename and the extention _aux.npz must accompany\n    e.g. /path/to/emulator.h5 /path/to/emulator_aux.npz\nsegmentation_size : int, default=40\n    If empirical_line is enabled, sets the size of segments to construct\nnum_neighbors : list[int], default=[]\n    Forced number of neighbors for empirical line extrapolation - overides default\n    set from segmentation_size parameter\natm_sigma : list[int], default=[2]\n    A list of smoothing factors to use during the atmospheric interpolation, one\n    for each atmospheric parameter (or broadcast to all if only one is provided).\n    Only used with the analytical line.\npressure_elevation : bool, default=False\n    Flag to retrieve elevation\nprebuilt_lut : str, default=None\n    Use this pre-constructed look up table for all retrievals. Must be an\n    ISOFIT-compatible RTE NetCDF\nno_min_lut_spacing : bool, default=False\n    Don't allow the LUTConfig to remove a LUT dimension because of minimal spacing.\ninversion_windows : list[float], default=None\n    Override the default inversion windows.  Will supercede any sensor specific\n    defaults that are in place.\n    Must be in 2-item tuples\nconfig_only : bool, default=False\n    Generates the configuration then exits before execution. If presolve is\n    enabled, that run will still occur.\ninterpolate_bad_rdn : bool, default=False\n    Flag to perform a per-pixel interpolation across no-data and NaN data bands.\n    Does not interpolate vectors that are entire no-data or NaN, only partial.\n    Currently only designed for wavelength interpolation on spectra.\n    Does NOT do any spatial interpolation\ninterpolate_inplace : bool, default=False\n    Flag to tell interpolation to work on the file in place, or generate a\n    new interpolated rdn file. The location of the new file will be in the\n    \"input\" directory within the working directory.\nskyview_factor : str, default=None\n    Flag to determine method to account for skyview factor. Default is None, creating an array of 1s.\n    Other option is \"slope\" which will approx. based on cos^2(slope/2).\n    Other option is a path to a skyview ENVI file computed via skyview.py utility or other source.\n    Please note data must range from 0-1.\nresources : bool, default=False\n    Enables the system resource tracker. Must also have the log_file set.\nretrieve_co2 : bool, default=False\n    Flag to retrieve CO2 in the state vector. Only available with emulator at the moment.\neof_path : str, default=None\n    Add 1 or 2 Empirical Orthogonal Functions to the state vector.  File is a 1-2 column text file\n    with one number per instrument channel.\nterrain_style : str, default=dem\n    Flag to set the terrain style.  dem uses provided obs values, flat sets the surface to the spheroid\n\nReferences\n----------\nD.R. Thompson, A. Braverman,P.G. Brodrick, A. Candela, N. Carbon, R.N. Clark,D. Connelly, R.O. Green, R.F.\nKokaly, L. Li, N. Mahowald, R.L. Miller, G.S. Okin, T.H.Painter, G.A. Swayze, M. Turmon, J. Susilouto, and\nD.S. Wettergreen. Quantifying Uncertainty for Remote Spectroscopy of Surface Composition. Remote Sensing of\nEnvironment, 2020. doi: https://doi.org/10.1016/j.rse.2020.111898.\n\nsRTMnet emulator:\nP.G. Brodrick, D.R. Thompson, J.E. Fahlen, M.L. Eastwood, C.M. Sarture, S.R. Lundeen, W. Olson-Duvall,\nN. Carmon, and R.O. Green. Generalized radiative transfer emulation for imaging spectroscopy reflectance\nretrievals. Remote Sensing of Environment, 261:112476, 2021.doi: 10.1016/j.rse.2021.112476.\n\n</pre> In\u00a0[8]: Copied! <pre># Add a ray shutdown, just in case this is being re-called\nimport ray\nray.shutdown()\n\n# Cleanup any previous runs; comment this out if you want to preserve a previous run's output\nif Path(paths.working).exists():\n    shutil.rmtree(paths.working)\n\napply_oe(\n    input_radiance    = paths.rdn, # Radiance\n    input_loc         = paths.loc, # Location\n    input_obs         = paths.obs, # Observations\n    working_directory = str(paths.working), # Output directory\n    sensor            = \"neon\",\n    surface_path      = paths.surface, # Surface priors - often changes\n    emulator_base     = f\"{env.srtmnet}/sRTMnet_v120.h5\",\n    surface_category  = \"multicomponent_surface\",\n\n    modtran_path    = None,\n    atmosphere_type = \"ATM_MIDLAT_SUMMER\", # MODTRAN\n    aerosol_climatology_path = None,       # MODTRAN\n\n    rdn_factors_path       = None, # RCC update used 'on the fly'\n    model_discrepancy_path = None, # Model discrepancy term - handle things like unknown radiative transfer model effects\n    channelized_uncertainty_path = None, # Channelized uncertainty - if you have an instrument model\n\n    multiple_restarts = False, # Useful if the AOD conditions are really challenging\n\n    presolve        = True,  # Attempts to solve for the right wv range\n    empirical_line  = False, # wavelength-specific local linear interpolation between radiance and reflectance\n    analytical_line = True,  # mathematical representation of OE given that the atmsophere is known\n\n    segmentation_size  = 10,\n    num_neighbors      = [5],\n    atm_sigma          = [0.5, 0.5],\n    pressure_elevation = False,\n\n    n_cores = os.cpu_count(),\n)\n</pre> # Add a ray shutdown, just in case this is being re-called import ray ray.shutdown()  # Cleanup any previous runs; comment this out if you want to preserve a previous run's output if Path(paths.working).exists():     shutil.rmtree(paths.working)  apply_oe(     input_radiance    = paths.rdn, # Radiance     input_loc         = paths.loc, # Location     input_obs         = paths.obs, # Observations     working_directory = str(paths.working), # Output directory     sensor            = \"neon\",     surface_path      = paths.surface, # Surface priors - often changes     emulator_base     = f\"{env.srtmnet}/sRTMnet_v120.h5\",     surface_category  = \"multicomponent_surface\",      modtran_path    = None,     atmosphere_type = \"ATM_MIDLAT_SUMMER\", # MODTRAN     aerosol_climatology_path = None,       # MODTRAN      rdn_factors_path       = None, # RCC update used 'on the fly'     model_discrepancy_path = None, # Model discrepancy term - handle things like unknown radiative transfer model effects     channelized_uncertainty_path = None, # Channelized uncertainty - if you have an instrument model      multiple_restarts = False, # Useful if the AOD conditions are really challenging      presolve        = True,  # Attempts to solve for the right wv range     empirical_line  = False, # wavelength-specific local linear interpolation between radiance and reflectance     analytical_line = True,  # mathematical representation of OE given that the atmsophere is known      segmentation_size  = 10,     num_neighbors      = [5],     atm_sigma          = [0.5, 0.5],     pressure_elevation = False,      n_cores = os.cpu_count(), ) <pre>INFO:2026-02-24,21:02:27 || apply_oe.py:apply_oe() | Checking input data files...\n</pre> <pre>INFO:2026-02-24,21:02:27 || apply_oe.py:apply_oe() | ...Data file checks complete\n</pre> <pre>INFO:2026-02-24,21:02:27 || apply_oe.py:apply_oe() | Setting up files and directories....\n</pre> <pre>INFO:2026-02-24,21:02:27 || template_construction.py:__init__() | Flightline ID: NIS01_20210403_173647\n</pre> <pre>INFO:2026-02-24,21:02:27 || template_construction.py:__init__() | no noise path found, proceeding without\n</pre> <pre>INFO:2026-02-24,21:02:27 || apply_oe.py:apply_oe() | ...file/directory setup complete\n</pre> <pre>INFO:2026-02-24,21:02:27 || apply_oe.py:apply_oe() | Using inversion windows: [[350.0, 1360.0], [1410, 1800.0], [1970.0, 2500.0]]\n</pre> <pre>INFO:2026-02-24,21:02:27 || template_construction.py:get_wavelengths() | No wavelength file provided. Obtaining wavelength grid from ENVI header of radiance cube.\n</pre> <pre>INFO:2026-02-24,21:02:27 || template_construction.py:get_wavelengths() | Wavelength units of nm inferred...converting to microns\n</pre> <pre>WARNING:2026-02-24,21:02:27 || template_construction.py:check_surface_model() | Center wavelengths provided in surface model file do not match wavelengths in radiance cube. Please consider rebuilding your surface model for optimal performance.\n</pre> <pre>INFO:2026-02-24,21:02:27 || apply_oe.py:apply_oe() | Observation means:\n</pre> <pre>INFO:2026-02-24,21:02:27 || apply_oe.py:apply_oe() | Path (km): 1.0036078691482544\n</pre> <pre>INFO:2026-02-24,21:02:27 || apply_oe.py:apply_oe() | To-sensor azimuth (deg): 153.4481201171875\n</pre> <pre>INFO:2026-02-24,21:02:27 || apply_oe.py:apply_oe() | To-sensor zenith (deg): 1.619314193725586\n</pre> <pre>INFO:2026-02-24,21:02:27 || apply_oe.py:apply_oe() | To-sun azimuth (deg): 145.23248291015625\n</pre> <pre>INFO:2026-02-24,21:02:27 || apply_oe.py:apply_oe() | To-sun zenith (deg): 39.8218994140625\n</pre> <pre>INFO:2026-02-24,21:02:27 || apply_oe.py:apply_oe() | Relative to-sun azimuth (deg): 31.813383102416992\n</pre> <pre>INFO:2026-02-24,21:02:27 || apply_oe.py:apply_oe() | Altitude (km): 2.692207098007202\n</pre> <pre>INFO:2026-02-24,21:02:27 || apply_oe.py:apply_oe() | Segmenting...\n</pre> <pre>2026-02-24 21:02:31,421\tINFO worker.py:2013 -- Started a local Ray instance.\n</pre> <pre>/home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/ray/_private/worker.py:2052: FutureWarning: Tip: In future versions of Ray, Ray will no longer override accelerator visible devices env var if num_gpus=0 or num_gpus=None (default). To enable this behavior and turn off this error message, set RAY_ACCEL_ENV_VAR_OVERRIDE_ON_ZERO=0\n  warnings.warn(\n</pre> <pre>(segment_chunk pid=3996) INFO:2026-02-24,21:02:33 ||| 0: starting\nINFO:2026-02-24,21:02:34 || apply_oe.py:apply_oe() | Extracting /home/runner/work/isofit-tutorials/isofit-tutorials/NEON/output/NIS01_20210403_173647/input/NIS01_20210403_173647_subs_rdn\n</pre> <pre>2026-02-24 21:02:34,033\tINFO worker.py:1831 -- Calling ray.init() again after it has already been called.\n</pre> <pre>(segment_chunk pid=3996) INFO:2026-02-24,21:02:34 ||| 0: completing\n(extract_chunk pid=3996) INFO:2026-02-24,21:02:34 ||| ini does not exist, falling back to defaults: ~/.isofit/isofit.ini\n</pre> <pre>INFO:2026-02-24,21:02:35 || apply_oe.py:apply_oe() | Extracting /home/runner/work/isofit-tutorials/isofit-tutorials/NEON/output/NIS01_20210403_173647/input/NIS01_20210403_173647_subs_obs\n</pre> <pre>2026-02-24 21:02:35,847\tINFO worker.py:1831 -- Calling ray.init() again after it has already been called.\n</pre> <pre>INFO:2026-02-24,21:02:35 || apply_oe.py:apply_oe() | Extracting /home/runner/work/isofit-tutorials/isofit-tutorials/NEON/output/NIS01_20210403_173647/input/NIS01_20210403_173647_subs_loc\n</pre> <pre>2026-02-24 21:02:35,873\tINFO worker.py:1831 -- Calling ray.init() again after it has already been called.\n</pre> <pre>INFO:2026-02-24,21:02:35 || apply_oe.py:apply_oe() | Skipping None, because is not a path.\n</pre> <pre>INFO:2026-02-24,21:02:35 || apply_oe.py:apply_oe() | Skipping None, because is not a path.\n</pre> <pre>INFO:2026-02-24,21:02:35 || apply_oe.py:apply_oe() | Pre-solve H2O grid: [0.2  0.84 1.49 2.13 2.77 3.42 4.06 4.7  5.35 5.99]\n</pre> <pre>INFO:2026-02-24,21:02:35 || apply_oe.py:apply_oe() | Writing H2O pre-solve configuration file.\n</pre> <pre>INFO:2026-02-24,21:02:35 || ini.py:toTemplate() | Saved converted json to: /home/runner/work/isofit-tutorials/isofit-tutorials/NEON/output/NIS01_20210403_173647/config/NIS01_20210403_173647_h2o.json.tmpl\n</pre> <pre>INFO:2026-02-24,21:02:35 || apply_oe.py:apply_oe() | Run ISOFIT initial guess\n</pre> <pre>WARNING:2026-02-24,21:02:35 || __init__.py:checkNumThreads() | \n******************************************************************************************\n! Number of threads is greater than 1 (currently: 4), this may greatly impact performance\n! Please set this the environment variables 'MKL_NUM_THREADS' and 'OMP_NUM_THREADS' to '1'\n******************************************************************************************\n</pre> <pre>INFO:2026-02-24,21:02:35 || configs.py:create_new_config() | Loading config file: /home/runner/work/isofit-tutorials/isofit-tutorials/NEON/output/NIS01_20210403_173647/config/NIS01_20210403_173647_h2o.json\n</pre> <pre>INFO:2026-02-24,21:02:35 || configs.py:get_config_errors() | Checking config sections for configuration issues\n</pre> <pre>INFO:2026-02-24,21:02:35 || configs.py:get_config_errors() | Configuration file checks complete, no errors found.\n</pre> <pre>/home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/fromnumeric.py:3824: RuntimeWarning: Mean of empty slice\n  return _methods._mean(a, axis=axis, dtype=dtype,\n/home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/_methods.py:142: RuntimeWarning: invalid value encountered in scalar divide\n  ret = ret.dtype.type(ret / rcount)\n(extract_chunk pid=3996) INFO:2026-02-24,21:02:35 ||| 0: starting\n(extract_chunk pid=3996) INFO:2026-02-24,21:02:35 ||| 0: starting\n(extract_chunk pid=3996) INFO:2026-02-24,21:02:35 ||| 0: starting\n</pre> <pre>2026-02-24 21:02:36,212\tINFO worker.py:1831 -- Calling ray.init() again after it has already been called.\n</pre> <pre>INFO:2026-02-24,21:02:36 || isofit.py:run() | Running surfaces: uniform_surface\n</pre> <pre>INFO:2026-02-24,21:02:36 || radiative_transfer_engine.py:__init__() | Loading from wavelength_file: /home/runner/work/isofit-tutorials/isofit-tutorials/NEON/output/NIS01_20210403_173647/data/wavelengths.txt\n</pre> <pre>INFO:2026-02-24,21:02:36 || radiative_transfer_engine.py:__init__() | No LUT store found, beginning initialization and simulations\n</pre> <pre>INFO:2026-02-24,21:02:36 || radiative_transfer_engine.py:__init__() | Initializing LUT file\n</pre> <pre>INFO:2026-02-24,21:02:36 || radiative_transfer_engine.py:runSimulations() | Running any pre-sim functions\n</pre> <pre>INFO:2026-02-24,21:02:36 || sRTMnet.py:preSim() | Creating a simulator configuration\n</pre> <pre>INFO:2026-02-24,21:02:36 || sRTMnet.py:preSim() | Building simulator and executing (6S)\n</pre> <pre>INFO:2026-02-24,21:02:36 || radiative_transfer_engine.py:__init__() | No LUT store found, beginning initialization and simulations\n</pre> <pre>INFO:2026-02-24,21:02:36 || radiative_transfer_engine.py:__init__() | Initializing LUT file\n</pre> <pre>INFO:2026-02-24,21:02:36 || radiative_transfer_engine.py:runSimulations() | Running any pre-sim functions\n</pre> <pre>INFO:2026-02-24,21:02:36 || radiative_transfer_engine.py:runSimulations() | Executing parallel simulations\n</pre> <pre>INFO:2026-02-24,21:02:44 || common.py:__call__() |  20.00% simulations complete (elapsed: 0:00:07.544804, rate: 0:00:00.754480, eta: 0:01:07.903236)\n</pre> <pre>INFO:2026-02-24,21:02:44 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:02:44 || common.py:__call__() |  30.00% simulations complete (elapsed: 0:00:07.811227, rate: 0:00:00.781123, eta: 0:00:31.244908)\n</pre> <pre>INFO:2026-02-24,21:02:44 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:02:44 || common.py:__call__() |  40.00% simulations complete (elapsed: 0:00:08.069939, rate: 0:00:00.806994, eta: 0:00:18.829858)\n</pre> <pre>INFO:2026-02-24,21:02:44 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:02:45 || common.py:__call__() |  50.00% simulations complete (elapsed: 0:00:08.647858, rate: 0:00:00.864786, eta: 0:00:12.971787)\n</pre> <pre>INFO:2026-02-24,21:02:45 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:02:48 || common.py:__call__() |  60.00% simulations complete (elapsed: 0:00:11.722653, rate: 0:00:01.172265, eta: 0:00:11.722653)\n</pre> <pre>INFO:2026-02-24,21:02:48 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:02:48 || common.py:__call__() |  70.00% simulations complete (elapsed: 0:00:12.137728, rate: 0:00:01.213773, eta: 0:00:08.091819)\n</pre> <pre>INFO:2026-02-24,21:02:48 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:02:49 || common.py:__call__() |  80.00% simulations complete (elapsed: 0:00:12.426125, rate: 0:00:01.242612, eta: 0:00:05.325482)\n</pre> <pre>INFO:2026-02-24,21:02:49 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:02:49 || common.py:__call__() |  90.00% simulations complete (elapsed: 0:00:12.874530, rate: 0:00:01.287453, eta: 0:00:03.218632)\n</pre> <pre>INFO:2026-02-24,21:02:49 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:02:51 || common.py:__call__() | 100.00% simulations complete (elapsed: 0:00:14.592269, rate: 0:00:01.459227, eta: 0:00:01.621363)\n</pre> <pre>INFO:2026-02-24,21:02:51 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:02:51 || radiative_transfer_engine.py:runSimulations() | Running any post-sim functions\n</pre> <pre>INFO:2026-02-24,21:02:52 || radiative_transfer_engine.py:runSimulations() | Saving post-sim data to index zero of all dimensions except wl\n</pre> <pre>INFO:2026-02-24,21:02:52 || luts.py:load() | Loading LUT into memory\n</pre> <pre>WARNING:2026-02-24,21:02:52 || luts.py:load() | thermal_upwelling is fully NaN, leaving as-is\n</pre> <pre>WARNING:2026-02-24,21:02:52 || luts.py:load() | thermal_downwelling is fully NaN, leaving as-is\n</pre> <pre>INFO:2026-02-24,21:02:52 || sRTMnet.py:preSim() | Interpolating simulator quantities to emulator size\n</pre> <pre>INFO:2026-02-24,21:02:52 || sRTMnet.py:preSim() | Loading and predicting with emulator on 4 cores\n</pre> <pre>INFO:2026-02-24,21:02:54 || radiative_transfer_engine.py:runSimulations() | Saving pre-sim data to index zero of all dimensions except wl\n</pre> <pre>INFO:2026-02-24,21:02:54 || radiative_transfer_engine.py:runSimulations() | Running any post-sim functions\n</pre> <pre>INFO:2026-02-24,21:02:54 || luts.py:load() | Loading LUT into memory\n</pre> <pre>WARNING:2026-02-24,21:02:54 || luts.py:load() | thermal_upwelling is fully NaN, leaving as-is\n</pre> <pre>WARNING:2026-02-24,21:02:54 || luts.py:load() | thermal_downwelling is fully NaN, leaving as-is\n</pre> <pre>INFO:2026-02-24,21:02:54 || isofit.py:run() | Beginning 420 inversions in 40 chunks using 4 cores\n</pre> <pre>(Worker pid=4295) ERROR:2026-02-24,21:03:00 ||| [x] Data path does not exist\n(Worker pid=4295) ERROR:2026-02-24,21:03:00 ||| The following path does not exist, please verify your installation environment: /home/runner/.isofit/data/earth_sun_distance.txt\n(Worker pid=4295) WARNING:2026-02-24,21:03:00 ||| Earth-sun-distance file not found on system. Proceeding without might cause some inaccuracies down the line.\n(Worker pid=4295) /home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/fromnumeric.py:3824: RuntimeWarning: Mean of empty slice\n(Worker pid=4295)   return _methods._mean(a, axis=axis, dtype=dtype,\n(Worker pid=4295) /home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/_methods.py:142: RuntimeWarning: invalid value encountered in scalar divide\n(Worker pid=4295)   ret = ret.dtype.type(ret / rcount)\n</pre> <pre>(Worker pid=4295) INFO:2026-02-24,21:03:01 ||| Worker 0 completed 1/~105.0:: 0.95% complete\n</pre> <pre>(Worker pid=4295) INFO:2026-02-24,21:03:07 ||| Worker at start location (42,0) completed 10/11\n(Worker pid=4298) ERROR:2026-02-24,21:03:01 ||| [x] Data path does not exist [repeated 3x across cluster] (Ray deduplicates logs by default. Set RAY_DEDUP_LOGS=0 to disable log deduplication, or see https://docs.ray.io/en/master/ray-observability/user-guides/configure-logging.html#log-deduplication for more options.)\n(Worker pid=4298) ERROR:2026-02-24,21:03:01 ||| The following path does not exist, please verify your installation environment: /home/runner/.isofit/data/earth_sun_distance.txt [repeated 3x across cluster]\n(Worker pid=4298) WARNING:2026-02-24,21:03:01 ||| Earth-sun-distance file not found on system. Proceeding without might cause some inaccuracies down the line. [repeated 3x across cluster]\n(Worker pid=4298) /home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/fromnumeric.py:3824: RuntimeWarning: Mean of empty slice [repeated 3x across cluster]\n(Worker pid=4298)   return _methods._mean(a, axis=axis, dtype=dtype, [repeated 3x across cluster]\n(Worker pid=4298) /home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/_methods.py:142: RuntimeWarning: invalid value encountered in scalar divide [repeated 3x across cluster]\n(Worker pid=4298)   ret = ret.dtype.type(ret / rcount) [repeated 3x across cluster]\n(Worker pid=4298) INFO:2026-02-24,21:03:02 ||| Worker 3 completed 1/~105.0:: 0.95% complete [repeated 3x across cluster]\n</pre> <pre>(Worker pid=4295) INFO:2026-02-24,21:03:13 ||| Worker at start location (52,0) completed 9/10 [repeated 4x across cluster]\n(Worker pid=4296) INFO:2026-02-24,21:03:08 ||| Worker 2 completed 12/~105.0:: 11.43% complete [repeated 4x across cluster]\n</pre> <pre>(Worker pid=4295) INFO:2026-02-24,21:03:19 ||| Worker at start location (95,0) completed 9/10 [repeated 4x across cluster]\n(Worker pid=4296) INFO:2026-02-24,21:03:15 ||| Worker 2 completed 23/~105.0:: 21.9% complete [repeated 4x across cluster]\n</pre> <pre>(Worker pid=4295) INFO:2026-02-24,21:03:26 ||| Worker at start location (139,0) completed 10/11 [repeated 4x across cluster]\n(Worker pid=4296) INFO:2026-02-24,21:03:22 ||| Worker 2 completed 34/~105.0:: 32.38% complete [repeated 4x across cluster]\n</pre> <pre>(Worker pid=4295) INFO:2026-02-24,21:03:32 ||| Worker at start location (182,0) completed 10/11 [repeated 4x across cluster]\n(Worker pid=4298) INFO:2026-02-24,21:03:28 ||| Worker 3 completed 44/~105.0:: 41.9% complete [repeated 4x across cluster]\n</pre> <pre>(Worker pid=4295) INFO:2026-02-24,21:03:39 ||| Worker at start location (225,0) completed 10/11 [repeated 4x across cluster]\n(Worker pid=4296) INFO:2026-02-24,21:03:35 ||| Worker 2 completed 56/~105.0:: 53.33% complete [repeated 4x across cluster]\n</pre> <pre>(Worker pid=4295) INFO:2026-02-24,21:03:45 ||| Worker at start location (268,0) completed 10/11 [repeated 4x across cluster]\n(Worker pid=4296) INFO:2026-02-24,21:03:41 ||| Worker 2 completed 67/~105.0:: 63.81% complete [repeated 4x across cluster]\n</pre> <pre>(Worker pid=4295) INFO:2026-02-24,21:03:52 ||| Worker at start location (311,0) completed 10/11 [repeated 4x across cluster]\n(Worker pid=4296) INFO:2026-02-24,21:03:48 ||| Worker 2 completed 78/~105.0:: 74.29% complete [repeated 4x across cluster]\n</pre> <pre>(Worker pid=4295) INFO:2026-02-24,21:03:59 ||| Worker at start location (354,0) completed 10/11 [repeated 4x across cluster]\n(Worker pid=4296) INFO:2026-02-24,21:03:55 ||| Worker 2 completed 89/~105.0:: 84.76% complete [repeated 4x across cluster]\n</pre> <pre>(Worker pid=4297) INFO:2026-02-24,21:04:04 ||| Worker at start location (419,0) completed 10/11 [repeated 5x across cluster]\n(Worker pid=4297) INFO:2026-02-24,21:03:59 ||| Worker 1 completed 97/~105.0:: 92.38% complete [repeated 3x across cluster]\nINFO:2026-02-24,21:04:04 || isofit.py:run() | Pixel class: uniform_surface inversions complete.\n</pre> <pre>INFO:2026-02-24,21:04:04 || isofit.py:run() | 69.96s total\n</pre> <pre>INFO:2026-02-24,21:04:04 || isofit.py:run() | 6.0031 spectra/s\n</pre> <pre>INFO:2026-02-24,21:04:04 || isofit.py:run() | 1.5008 spectra/s/core\n</pre> <pre>INFO:2026-02-24,21:04:04 || isofit.py:run() | All Inversions complete.\n</pre> <pre>INFO:2026-02-24,21:04:04 || isofit.py:run() | 88.66s total\n</pre> <pre>INFO:2026-02-24,21:04:04 || isofit.py:run() | 4.7373 spectra/s\n</pre> <pre>INFO:2026-02-24,21:04:04 || isofit.py:run() | 1.1843 spectra/s/core\n</pre> <pre>INFO:2026-02-24,21:04:04 || apply_oe.py:apply_oe() | Full (non-aerosol) LUTs:\n</pre> <pre>INFO:2026-02-24,21:04:04 || apply_oe.py:apply_oe() | Elevation: None\n</pre> <pre>INFO:2026-02-24,21:04:04 || apply_oe.py:apply_oe() | To-sensor zenith: [0.9608 2.9675]\n</pre> <pre>INFO:2026-02-24,21:04:04 || apply_oe.py:apply_oe() | To-sun zenith: None\n</pre> <pre>INFO:2026-02-24,21:04:04 || apply_oe.py:apply_oe() | Relative to-sun azimuth: [3.80000e-03 4.12002e+01 8.23965e+01]\n</pre> <pre>INFO:2026-02-24,21:04:04 || apply_oe.py:apply_oe() | H2O Vapor: [0.6033 0.6628]\n</pre> <pre>INFO:2026-02-24,21:04:04 || apply_oe.py:apply_oe() | Writing main configuration file.\n</pre> <pre>INFO:2026-02-24,21:04:04 || template_construction.py:load_climatology() | Loading Climatology\n</pre> <pre>INFO:2026-02-24,21:04:04 || template_construction.py:load_climatology() | Climatology Loaded.  Aerosol State Vector:\n{'AOT550': {'bounds': [0.04209, 1.0], 'scale': 1, 'init': 0.137881, 'prior_sigma': 10.0, 'prior_mean': 0.137881}}\nAerosol LUT Grid:\n{'AOT550': [0.04209, 0.137881, 0.233672, 0.329463, 0.425254, 0.521045, 0.6168359999999999, 0.712627, 0.808418, 0.9042089999999999, 1.0]}\nAerosol model path:/home/runner/work/isofit-tutorials/data/aerosol_model.txt\n</pre> <pre>INFO:2026-02-24,21:04:04 || ini.py:toTemplate() | Saved converted json to: /home/runner/work/isofit-tutorials/isofit-tutorials/NEON/output/NIS01_20210403_173647/config/NIS01_20210403_173647_isofit.json.tmpl\n</pre> <pre>INFO:2026-02-24,21:04:04 || apply_oe.py:apply_oe() | Running ISOFIT with full LUT\n</pre> <pre>WARNING:2026-02-24,21:04:04 || __init__.py:checkNumThreads() | \n******************************************************************************************\n! Number of threads is greater than 1 (currently: 4), this may greatly impact performance\n! Please set this the environment variables 'MKL_NUM_THREADS' and 'OMP_NUM_THREADS' to '1'\n******************************************************************************************\n</pre> <pre>INFO:2026-02-24,21:04:04 || configs.py:create_new_config() | Loading config file: /home/runner/work/isofit-tutorials/isofit-tutorials/NEON/output/NIS01_20210403_173647/config/NIS01_20210403_173647_isofit.json\n</pre> <pre>INFO:2026-02-24,21:04:04 || configs.py:get_config_errors() | Checking config sections for configuration issues\n</pre> <pre>INFO:2026-02-24,21:04:04 || configs.py:get_config_errors() | Configuration file checks complete, no errors found.\n</pre> <pre>/home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/fromnumeric.py:3824: RuntimeWarning: Mean of empty slice\n  return _methods._mean(a, axis=axis, dtype=dtype,\n/home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/_methods.py:142: RuntimeWarning: invalid value encountered in scalar divide\n  ret = ret.dtype.type(ret / rcount)\n</pre> <pre>2026-02-24 21:04:05,169\tINFO worker.py:1831 -- Calling ray.init() again after it has already been called.\n</pre> <pre>INFO:2026-02-24,21:04:05 || isofit.py:run() | Running surfaces: uniform_surface\n</pre> <pre>INFO:2026-02-24,21:04:05 || radiative_transfer_engine.py:__init__() | Loading from wavelength_file: /home/runner/work/isofit-tutorials/isofit-tutorials/NEON/output/NIS01_20210403_173647/data/wavelengths.txt\n</pre> <pre>INFO:2026-02-24,21:04:05 || radiative_transfer_engine.py:__init__() | No LUT store found, beginning initialization and simulations\n</pre> <pre>INFO:2026-02-24,21:04:05 || radiative_transfer_engine.py:__init__() | Initializing LUT file\n</pre> <pre>INFO:2026-02-24,21:04:05 || radiative_transfer_engine.py:runSimulations() | Running any pre-sim functions\n</pre> <pre>INFO:2026-02-24,21:04:05 || sRTMnet.py:preSim() | Creating a simulator configuration\n</pre> <pre>INFO:2026-02-24,21:04:05 || sRTMnet.py:preSim() | Building simulator and executing (6S)\n</pre> <pre>INFO:2026-02-24,21:04:05 || radiative_transfer_engine.py:__init__() | No LUT store found, beginning initialization and simulations\n</pre> <pre>INFO:2026-02-24,21:04:05 || radiative_transfer_engine.py:__init__() | Initializing LUT file\n</pre> <pre>INFO:2026-02-24,21:04:05 || radiative_transfer_engine.py:runSimulations() | Running any pre-sim functions\n</pre> <pre>INFO:2026-02-24,21:04:05 || radiative_transfer_engine.py:runSimulations() | Executing parallel simulations\n</pre> <pre>INFO:2026-02-24,21:04:30 || common.py:__call__() |  10.61% simulations complete (elapsed: 0:00:24.937491, rate: 0:00:00.188920, eta: 0:03:44.437419)\n</pre> <pre>INFO:2026-02-24,21:04:30 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:04:46 || common.py:__call__() |  20.45% simulations complete (elapsed: 0:00:40.191390, rate: 0:00:00.304480, eta: 0:02:40.765560)\n</pre> <pre>INFO:2026-02-24,21:04:46 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:05:01 || common.py:__call__() |  30.30% simulations complete (elapsed: 0:00:55.769390, rate: 0:00:00.422495, eta: 0:02:10.128577)\n</pre> <pre>INFO:2026-02-24,21:05:01 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:05:21 || common.py:__call__() |  40.15% simulations complete (elapsed: 0:01:15.397363, rate: 0:00:00.571192, eta: 0:01:53.096045)\n</pre> <pre>INFO:2026-02-24,21:05:21 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:05:37 || common.py:__call__() |  50.00% simulations complete (elapsed: 0:01:31.692184, rate: 0:00:00.694638, eta: 0:01:31.692184)\n</pre> <pre>INFO:2026-02-24,21:05:37 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:05:52 || common.py:__call__() |  60.61% simulations complete (elapsed: 0:01:46.380820, rate: 0:00:00.805915, eta: 0:01:10.920547)\n</pre> <pre>INFO:2026-02-24,21:05:52 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:06:11 || common.py:__call__() |  70.45% simulations complete (elapsed: 0:02:05.306915, rate: 0:00:00.949295, eta: 0:00:53.702964)\n</pre> <pre>INFO:2026-02-24,21:06:11 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:06:26 || common.py:__call__() |  80.30% simulations complete (elapsed: 0:02:20.785525, rate: 0:00:01.066557, eta: 0:00:35.196381)\n</pre> <pre>INFO:2026-02-24,21:06:26 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:06:42 || common.py:__call__() |  90.15% simulations complete (elapsed: 0:02:36.902678, rate: 0:00:01.188657, eta: 0:00:17.433631)\n</pre> <pre>INFO:2026-02-24,21:06:42 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:06:59 || common.py:__call__() | 100.00% simulations complete (elapsed: 0:02:53.186238, rate: 0:00:01.312017, eta: 0:00:00)\n</pre> <pre>INFO:2026-02-24,21:06:59 || radiative_transfer_engine.py:runSimulations() | Flushing netCDF to disk\n</pre> <pre>INFO:2026-02-24,21:06:59 || radiative_transfer_engine.py:runSimulations() | Running any post-sim functions\n</pre> <pre>INFO:2026-02-24,21:06:59 || radiative_transfer_engine.py:runSimulations() | Saving post-sim data to index zero of all dimensions except wl\n</pre> <pre>INFO:2026-02-24,21:06:59 || luts.py:load() | Loading LUT into memory\n</pre> <pre>WARNING:2026-02-24,21:06:59 || luts.py:load() | thermal_upwelling is fully NaN, leaving as-is\n</pre> <pre>WARNING:2026-02-24,21:06:59 || luts.py:load() | thermal_downwelling is fully NaN, leaving as-is\n</pre> <pre>INFO:2026-02-24,21:06:59 || sRTMnet.py:preSim() | Interpolating simulator quantities to emulator size\n</pre> <pre>INFO:2026-02-24,21:06:59 || sRTMnet.py:preSim() | Loading and predicting with emulator on 4 cores\n</pre> <pre>INFO:2026-02-24,21:07:01 || radiative_transfer_engine.py:runSimulations() | Saving pre-sim data to index zero of all dimensions except wl\n</pre> <pre>INFO:2026-02-24,21:07:02 || radiative_transfer_engine.py:runSimulations() | Running any post-sim functions\n</pre> <pre>INFO:2026-02-24,21:07:02 || luts.py:load() | Loading LUT into memory\n</pre> <pre>WARNING:2026-02-24,21:07:02 || luts.py:load() | thermal_upwelling is fully NaN, leaving as-is\n</pre> <pre>WARNING:2026-02-24,21:07:02 || luts.py:load() | thermal_downwelling is fully NaN, leaving as-is\n</pre> <pre>INFO:2026-02-24,21:07:02 || isofit.py:run() | Beginning 420 inversions in 40 chunks using 4 cores\n</pre> <pre>(Worker pid=5142) ERROR:2026-02-24,21:07:08 ||| [x] Data path does not exist\n(Worker pid=5142) ERROR:2026-02-24,21:07:08 ||| The following path does not exist, please verify your installation environment: /home/runner/.isofit/data/earth_sun_distance.txt\n(Worker pid=5142) WARNING:2026-02-24,21:07:08 ||| Earth-sun-distance file not found on system. Proceeding without might cause some inaccuracies down the line.\n(Worker pid=4295) INFO:2026-02-24,21:04:04 ||| Worker at start location (397,0) completed 10/11\n(Worker pid=5142) /home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/fromnumeric.py:3824: RuntimeWarning: Mean of empty slice\n(Worker pid=5142)   return _methods._mean(a, axis=axis, dtype=dtype,\n(Worker pid=5142) /home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/_methods.py:142: RuntimeWarning: invalid value encountered in scalar divide\n(Worker pid=5142)   ret = ret.dtype.type(ret / rcount)\n</pre> <pre>(Worker pid=5143) INFO:2026-02-24,21:07:13 ||| Worker 3 completed 1/~105.0:: 0.95% complete\n</pre> <pre>(Worker pid=5143) ERROR:2026-02-24,21:07:08 ||| [x] Data path does not exist [repeated 3x across cluster]\n(Worker pid=5143) ERROR:2026-02-24,21:07:08 ||| The following path does not exist, please verify your installation environment: /home/runner/.isofit/data/earth_sun_distance.txt [repeated 3x across cluster]\n(Worker pid=5143) WARNING:2026-02-24,21:07:08 ||| Earth-sun-distance file not found on system. Proceeding without might cause some inaccuracies down the line. [repeated 3x across cluster]\n(Worker pid=5143) /home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/fromnumeric.py:3824: RuntimeWarning: Mean of empty slice [repeated 3x across cluster]\n(Worker pid=5143)   return _methods._mean(a, axis=axis, dtype=dtype, [repeated 3x across cluster]\n(Worker pid=5143) /home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/_methods.py:142: RuntimeWarning: invalid value encountered in scalar divide [repeated 3x across cluster]\n(Worker pid=5143)   ret = ret.dtype.type(ret / rcount) [repeated 3x across cluster]\n</pre> <pre>(Worker pid=5143) INFO:2026-02-24,21:07:59 ||| Worker at start location (9,0) completed 9/10\n(Worker pid=5142) INFO:2026-02-24,21:07:14 ||| Worker 0 completed 1/~105.0:: 0.95% complete [repeated 3x across cluster]\n</pre> <pre>(Worker pid=5143) INFO:2026-02-24,21:08:04 ||| Worker 3 completed 11/~105.0:: 10.48% complete\n</pre> <pre>(Worker pid=5145) INFO:2026-02-24,21:08:06 ||| Worker at start location (31,0) completed 10/11\n</pre> <pre>(Worker pid=5145) INFO:2026-02-24,21:08:12 ||| Worker 1 completed 12/~105.0:: 11.43% complete\n(Worker pid=5142) INFO:2026-02-24,21:08:09 ||| Worker at start location (42,0) completed 10/11 [repeated 2x across cluster]\n</pre> <pre>(Worker pid=5142) INFO:2026-02-24,21:08:14 ||| Worker 0 completed 12/~105.0:: 11.43% complete [repeated 2x across cluster]\n(Worker pid=5143) INFO:2026-02-24,21:08:52 ||| Worker at start location (52,0) completed 9/10\n</pre> <pre>(Worker pid=5143) INFO:2026-02-24,21:08:58 ||| Worker 3 completed 21/~105.0:: 20.0% complete\n</pre> <pre>(Worker pid=5144) INFO:2026-02-24,21:09:06 ||| Worker at start location (74,0) completed 10/11\n</pre> <pre>(Worker pid=5144) INFO:2026-02-24,21:09:11 ||| Worker 2 completed 23/~105.0:: 21.9% complete\n</pre> <pre>(Worker pid=5145) INFO:2026-02-24,21:09:09 ||| Worker at start location (63,0) completed 10/11 [repeated 2x across cluster]\n</pre> <pre>(Worker pid=5145) INFO:2026-02-24,21:09:14 ||| Worker 1 completed 23/~105.0:: 21.9% complete [repeated 2x across cluster]\n(Worker pid=5143) INFO:2026-02-24,21:09:41 ||| Worker at start location (95,0) completed 9/10\n</pre> <pre>(Worker pid=5144) INFO:2026-02-24,21:10:01 ||| Worker at start location (106,0) completed 10/11\n(Worker pid=5143) INFO:2026-02-24,21:09:46 ||| Worker 3 completed 31/~105.0:: 29.52% complete\n</pre> <pre>(Worker pid=5144) INFO:2026-02-24,21:10:06 ||| Worker 2 completed 34/~105.0:: 32.38% complete\n(Worker pid=5142) INFO:2026-02-24,21:10:02 ||| Worker at start location (117,0) completed 10/11\n</pre> <pre>(Worker pid=5145) INFO:2026-02-24,21:10:06 ||| Worker at start location (128,0) completed 10/11\n</pre> <pre>(Worker pid=5145) INFO:2026-02-24,21:10:12 ||| Worker 1 completed 34/~105.0:: 32.38% complete [repeated 2x across cluster]\n</pre> <pre>(Worker pid=5143) INFO:2026-02-24,21:10:40 ||| Worker at start location (139,0) completed 10/11\n</pre> <pre>(Worker pid=5143) INFO:2026-02-24,21:10:43 ||| Worker 3 completed 42/~105.0:: 40.0% complete\n</pre> <pre>(Worker pid=5144) INFO:2026-02-24,21:10:56 ||| Worker at start location (149,0) completed 9/10\n</pre> <pre>(Worker pid=5142) INFO:2026-02-24,21:10:59 ||| Worker at start location (160,0) completed 10/11\n</pre> <pre>(Worker pid=5144) INFO:2026-02-24,21:11:01 ||| Worker 2 completed 44/~105.0:: 41.9% complete\n</pre> <pre>(Worker pid=5145) INFO:2026-02-24,21:11:05 ||| Worker at start location (171,0) completed 10/11\n</pre> <pre>(Worker pid=5145) INFO:2026-02-24,21:11:09 ||| Worker 1 completed 45/~105.0:: 42.86% complete [repeated 2x across cluster]\n</pre> <pre>(Worker pid=5143) INFO:2026-02-24,21:11:34 ||| Worker at start location (182,0) completed 10/11\n</pre> <pre>(Worker pid=5143) INFO:2026-02-24,21:11:40 ||| Worker 3 completed 53/~105.0:: 50.48% complete\n</pre> <pre>(Worker pid=5144) INFO:2026-02-24,21:11:43 ||| Worker at start location (192,0) completed 9/10\n</pre> <pre>(Worker pid=5144) INFO:2026-02-24,21:11:49 ||| Worker 2 completed 54/~105.0:: 51.43% complete\n</pre> <pre>(Worker pid=5145) INFO:2026-02-24,21:11:56 ||| Worker at start location (214,0) completed 10/11\n</pre> <pre>(Worker pid=5145) INFO:2026-02-24,21:12:01 ||| Worker 1 completed 56/~105.0:: 53.33% complete\n(Worker pid=5142) INFO:2026-02-24,21:11:58 ||| Worker at start location (203,0) completed 10/11\n</pre> <pre>(Worker pid=5143) INFO:2026-02-24,21:12:31 ||| Worker at start location (225,0) completed 10/11\n(Worker pid=5142) INFO:2026-02-24,21:12:03 ||| Worker 0 completed 56/~105.0:: 53.33% complete\n</pre> <pre>(Worker pid=5144) INFO:2026-02-24,21:12:36 ||| Worker at start location (235,0) completed 9/10\n</pre> <pre>(Worker pid=5143) INFO:2026-02-24,21:12:37 ||| Worker 3 completed 64/~105.0:: 60.95% complete\n</pre> <pre>(Worker pid=5145) INFO:2026-02-24,21:12:56 ||| Worker at start location (246,0) completed 10/11\n(Worker pid=5144) INFO:2026-02-24,21:12:41 ||| Worker 2 completed 64/~105.0:: 60.95% complete\n</pre> <pre>(Worker pid=5145) INFO:2026-02-24,21:13:02 ||| Worker 1 completed 67/~105.0:: 63.81% complete\n(Worker pid=5142) INFO:2026-02-24,21:12:59 ||| Worker at start location (257,0) completed 10/11\n</pre> <pre>(Worker pid=5143) INFO:2026-02-24,21:13:30 ||| Worker at start location (268,0) completed 10/11\n(Worker pid=5142) INFO:2026-02-24,21:13:04 ||| Worker 0 completed 67/~105.0:: 63.81% complete\n</pre> <pre>(Worker pid=5143) INFO:2026-02-24,21:13:35 ||| Worker 3 completed 75/~105.0:: 71.43% complete\n(Worker pid=5144) INFO:2026-02-24,21:13:34 ||| Worker at start location (279,0) completed 10/11\n</pre> <pre>(Worker pid=5145) INFO:2026-02-24,21:13:49 ||| Worker at start location (289,0) completed 9/10\n(Worker pid=5144) INFO:2026-02-24,21:13:40 ||| Worker 2 completed 75/~105.0:: 71.43% complete\n</pre> <pre>(Worker pid=5145) INFO:2026-02-24,21:13:54 ||| Worker 1 completed 77/~105.0:: 73.33% complete\n</pre> <pre>(Worker pid=5142) INFO:2026-02-24,21:13:56 ||| Worker at start location (300,0) completed 10/11\n</pre> <pre>(Worker pid=5142) INFO:2026-02-24,21:14:02 ||| Worker 0 completed 78/~105.0:: 74.29% complete\n</pre> <pre>(Worker pid=5143) INFO:2026-02-24,21:14:28 ||| Worker at start location (311,0) completed 10/11\n</pre> <pre>(Worker pid=5143) INFO:2026-02-24,21:14:33 ||| Worker 3 completed 86/~105.0:: 81.9% complete\n(Worker pid=5144) INFO:2026-02-24,21:14:29 ||| Worker at start location (322,0) completed 10/11\n</pre> <pre>(Worker pid=5145) INFO:2026-02-24,21:14:41 ||| Worker at start location (332,0) completed 9/10\n(Worker pid=5144) INFO:2026-02-24,21:14:34 ||| Worker 2 completed 86/~105.0:: 81.9% complete\n</pre> <pre>(Worker pid=5145) INFO:2026-02-24,21:14:46 ||| Worker 1 completed 87/~105.0:: 82.86% complete\n</pre> <pre>(Worker pid=5142) INFO:2026-02-24,21:14:54 ||| Worker at start location (343,0) completed 10/11\n</pre> <pre>(Worker pid=5142) INFO:2026-02-24,21:14:59 ||| Worker 0 completed 89/~105.0:: 84.76% complete\n</pre> <pre>(Worker pid=5143) INFO:2026-02-24,21:15:25 ||| Worker at start location (354,0) completed 10/11\n</pre> <pre>(Worker pid=5144) INFO:2026-02-24,21:15:27 ||| Worker at start location (365,0) completed 10/11\n</pre> <pre>(Worker pid=5143) INFO:2026-02-24,21:15:29 ||| Worker 3 completed 97/~105.0:: 92.38% complete\n</pre> <pre>(Worker pid=5145) INFO:2026-02-24,21:15:32 ||| Worker at start location (375,0) completed 9/10\n</pre> <pre>(Worker pid=5145) INFO:2026-02-24,21:15:38 ||| Worker 1 completed 97/~105.0:: 92.38% complete [repeated 2x across cluster]\n</pre> <pre>(Worker pid=5142) INFO:2026-02-24,21:15:51 ||| Worker at start location (386,0) completed 10/11\n</pre> <pre>(Worker pid=5143) INFO:2026-02-24,21:16:09 ||| Worker at start location (397,0) completed 10/11\n</pre> <pre>(Worker pid=5144) INFO:2026-02-24,21:16:16 ||| Worker at start location (408,0) completed 10/11\n</pre> <pre>INFO:2026-02-24,21:16:20 || isofit.py:run() | Pixel class: uniform_surface inversions complete.\n</pre> <pre>INFO:2026-02-24,21:16:20 || isofit.py:run() | 558.34s total\n</pre> <pre>INFO:2026-02-24,21:16:20 || isofit.py:run() | 0.7522 spectra/s\n</pre> <pre>INFO:2026-02-24,21:16:20 || isofit.py:run() | 0.1881 spectra/s/core\n</pre> <pre>INFO:2026-02-24,21:16:20 || isofit.py:run() | All Inversions complete.\n</pre> <pre>INFO:2026-02-24,21:16:20 || isofit.py:run() | 735.62s total\n</pre> <pre>INFO:2026-02-24,21:16:20 || isofit.py:run() | 0.5709 spectra/s\n</pre> <pre>INFO:2026-02-24,21:16:20 || isofit.py:run() | 0.1427 spectra/s/core\n</pre> <pre>INFO:2026-02-24,21:16:20 || apply_oe.py:apply_oe() | Analytical line inference\n</pre> <pre>INFO:2026-02-24,21:16:20 || configs.py:create_new_config() | Loading config file: /home/runner/work/isofit-tutorials/isofit-tutorials/NEON/output/NIS01_20210403_173647/config/NIS01_20210403_173647_isofit.json\n</pre> <pre>/home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/fromnumeric.py:3824: RuntimeWarning: Mean of empty slice\n  return _methods._mean(a, axis=axis, dtype=dtype,\n/home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/_methods.py:142: RuntimeWarning: invalid value encountered in scalar divide\n  ret = ret.dtype.type(ret / rcount)\n</pre> <pre>2026-02-24 21:16:21,062\tINFO worker.py:1831 -- Calling ray.init() again after it has already been called.\n</pre> <pre>INFO:2026-02-24,21:16:21 || atm_interpolation.py:atm_interpolation() | Beginning atmospheric interpolation 4 cores\n</pre> <pre>(_run_chunk pid=5398) /home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/isofit/utils/atm_interpolation.py:182: LinAlgWarning: An ill-conditioned matrix detected: slice 0 has rcond = 5.806051187360241e-33.\n(_run_chunk pid=5398)   bhat[i, :] = (inv(X.T @ W @ X) @ X.T @ W @ y).T\n(Worker pid=5145) INFO:2026-02-24,21:16:20 ||| Worker at start location (419,0) completed 10/11\n</pre> <pre>INFO:2026-02-24,21:16:26 || atm_interpolation.py:atm_interpolation() | Parallel atmospheric interpolations complete.  4.94978666305542 s total, 852.7640254690184 spectra/s, 213.1910063672546 spectra/s/core\n</pre> <pre>2026-02-24 21:16:26,042\tINFO worker.py:1831 -- Calling ray.init() again after it has already been called.\n</pre> <pre>INFO:2026-02-24,21:16:26 || radiative_transfer_engine.py:__init__() | Loading from wavelength_file: /home/runner/work/isofit-tutorials/isofit-tutorials/NEON/output/NIS01_20210403_173647/data/wavelengths.txt\n</pre> <pre>INFO:2026-02-24,21:16:26 || radiative_transfer_engine.py:__init__() | Prebuilt LUT provided\n</pre> <pre>INFO:2026-02-24,21:16:26 || luts.py:load() | Loading LUT into memory\n</pre> <pre>WARNING:2026-02-24,21:16:26 || luts.py:load() | thermal_upwelling is fully NaN, leaving as-is\n</pre> <pre>WARNING:2026-02-24,21:16:26 || luts.py:load() | thermal_downwelling is fully NaN, leaving as-is\n</pre> <pre>INFO:2026-02-24,21:16:26 || radiative_transfer_engine.py:__init__() | LUT grid loaded from file\n</pre> <pre>(Worker pid=5429) ERROR:2026-02-24,21:16:31 ||| [x] Data path does not exist\n(Worker pid=5429) ERROR:2026-02-24,21:16:31 ||| The following path does not exist, please verify your installation environment: /home/runner/.isofit/data/earth_sun_distance.txt\n(Worker pid=5429) WARNING:2026-02-24,21:16:31 ||| Earth-sun-distance file not found on system. Proceeding without might cause some inaccuracies down the line.\n(Worker pid=5429) /home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/fromnumeric.py:3824: RuntimeWarning: Mean of empty slice\n(Worker pid=5429)   return _methods._mean(a, axis=axis, dtype=dtype,\n(Worker pid=5429) /home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/_methods.py:142: RuntimeWarning: invalid value encountered in scalar divide\n(Worker pid=5429)   ret = ret.dtype.type(ret / rcount)\n(_run_chunk pid=5400) /home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/isofit/utils/atm_interpolation.py:182: LinAlgWarning: An ill-conditioned matrix detected: slice 0 has rcond = 5.806051187360241e-33. [repeated 3x across cluster]\n(_run_chunk pid=5400)   bhat[i, :] = (inv(X.T @ W @ X) @ X.T @ W @ y).T [repeated 3x across cluster]\n</pre> <pre>(Worker pid=5648) INFO:2026-02-24,21:16:36 ||| Analytical line writing lines: 3 to 4. Surface: uniform_surface\n(Worker pid=5649) ERROR:2026-02-24,21:16:32 ||| [x] Data path does not exist [repeated 3x across cluster]\n(Worker pid=5649) ERROR:2026-02-24,21:16:32 ||| The following path does not exist, please verify your installation environment: /home/runner/.isofit/data/earth_sun_distance.txt [repeated 3x across cluster]\n(Worker pid=5649) WARNING:2026-02-24,21:16:32 ||| Earth-sun-distance file not found on system. Proceeding without might cause some inaccuracies down the line. [repeated 3x across cluster]\n(Worker pid=5649) /home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/fromnumeric.py:3824: RuntimeWarning: Mean of empty slice [repeated 3x across cluster]\n(Worker pid=5649)   return _methods._mean(a, axis=axis, dtype=dtype, [repeated 3x across cluster]\n(Worker pid=5649) /home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/_methods.py:142: RuntimeWarning: invalid value encountered in scalar divide [repeated 3x across cluster]\n(Worker pid=5649)   ret = ret.dtype.type(ret / rcount) [repeated 3x across cluster]\n</pre> <pre>(Worker pid=5650) INFO:2026-02-24,21:16:46 ||| Analytical line writing lines: 11 to 12. Surface: uniform_surface [repeated 5x across cluster]\n</pre> <pre>(Worker pid=5648) INFO:2026-02-24,21:16:51 ||| Analytical line writing lines: 16 to 17. Surface: uniform_surface [repeated 4x across cluster]\n</pre> <pre>(Worker pid=5429) INFO:2026-02-24,21:16:59 ||| Analytical line writing lines: 17 to 19. Surface: uniform_surface [repeated 3x across cluster]\n</pre> <pre>(Worker pid=5650) INFO:2026-02-24,21:17:05 ||| Analytical line writing lines: 22 to 24. Surface: uniform_surface [repeated 3x across cluster]\n</pre> <pre>(Worker pid=5648) INFO:2026-02-24,21:17:10 ||| Analytical line writing lines: 32 to 33. Surface: uniform_surface [repeated 4x across cluster]\n</pre> <pre>(Worker pid=5429) INFO:2026-02-24,21:17:18 ||| Analytical line writing lines: 33 to 35. Surface: uniform_surface [repeated 3x across cluster]\n</pre> <pre>(Worker pid=5650) INFO:2026-02-24,21:17:24 ||| Analytical line writing lines: 38 to 40. Surface: uniform_surface [repeated 3x across cluster]\n</pre> <pre>(Worker pid=5429) INFO:2026-02-24,21:17:32 ||| Analytical line writing lines: 50 to 51. Surface: uniform_surface [repeated 4x across cluster]\n</pre> <pre>(Worker pid=5649) INFO:2026-02-24,21:17:39 ||| Analytical line writing lines: 51 to 53. Surface: uniform_surface [repeated 4x across cluster]\n</pre> <pre>(Worker pid=5649) INFO:2026-02-24,21:17:46 ||| Analytical line writing lines: 59 to 61. Surface: uniform_surface [repeated 4x across cluster]\n</pre> <pre>INFO:2026-02-24,21:17:48 || analytical_line.py:analytical_line() | Analytical line inversions complete.  82.1s total, 51.4113 spectra/s, 12.8528 spectra/s/core\n</pre> <pre>INFO:2026-02-24,21:17:48 || apply_oe.py:apply_oe() | Done.\n</pre> In\u00a0[9]: Copied! <pre># Load in the ISOFIT reflectance output\nds = envi.open(paths.working / f\"output/{neon_str}_rfl.hdr\")\nrfl = ds.open_memmap(interleave='bip')\nrgb = rfl[:, :, [60, 40, 30]].copy()\nwl = np.array(ds.metadata['wavelength'], dtype=float)\n\n# Find the bounding box for all regions of interest (RoI)\nregions = report[neon_id]\nbounds = np.vstack(list(regions.values()))\ny = bounds[:, 0].min() - 5 # , bounds[:, 1].max() + 5\nx = bounds[:, 2].min() - 5 # , bounds[:, 3].max() + 5\n</pre> # Load in the ISOFIT reflectance output ds = envi.open(paths.working / f\"output/{neon_str}_rfl.hdr\") rfl = ds.open_memmap(interleave='bip') rgb = rfl[:, :, [60, 40, 30]].copy() wl = np.array(ds.metadata['wavelength'], dtype=float)  # Find the bounding box for all regions of interest (RoI) regions = report[neon_id] bounds = np.vstack(list(regions.values())) y = bounds[:, 0].min() - 5 # , bounds[:, 1].max() + 5 x = bounds[:, 2].min() - 5 # , bounds[:, 3].max() + 5 In\u00a0[10]: Copied! <pre># Plot the RoIs\nfig, ax = plt.subplots(figsize=(7, 7))\n\nax.imshow(rgb / np.max(rgb, axis=(0, 1))) # Dividing brightens the image\nax.set_title(neon_str)\n\nfor i, (roi, region) in enumerate(regions.items()):\n    rect = patches.Rectangle(\n        (region[2] - x, region[0] - y),\n        region[3] - region[2],\n        region[1] - region[0],\n        linewidth = 1,\n        edgecolor = f'C{i}',\n        facecolor = 'none',\n        label = roi\n    )\n    ax.add_patch(rect)\nax.legend(loc='lower right')\n</pre> # Plot the RoIs fig, ax = plt.subplots(figsize=(7, 7))  ax.imshow(rgb / np.max(rgb, axis=(0, 1))) # Dividing brightens the image ax.set_title(neon_str)  for i, (roi, region) in enumerate(regions.items()):     rect = patches.Rectangle(         (region[2] - x, region[0] - y),         region[3] - region[2],         region[1] - region[0],         linewidth = 1,         edgecolor = f'C{i}',         facecolor = 'none',         label = roi     )     ax.add_patch(rect) ax.legend(loc='lower right') Out[10]: <pre>&lt;matplotlib.legend.Legend at 0x7f34b627aa50&gt;</pre> In\u00a0[11]: Copied! <pre>fig, axes = plt.subplots(len(regions), sharex=True, figsize=(10, 3*len(regions)))\n\nfor i, (roi, region) in enumerate(regions.items()):\n    ax = axes[i]\n\n    in_situ = np.genfromtxt(paths.insitu / f'{roi}01/Data/{roi}01_Refl.dat', skip_header=3)\n    ax.plot(in_situ[:, 0], in_situ[:, 1], label='In Situ', c='red', ls='-')\n\n    mean_rfl = np.mean(\n        rfl[\n            region[0] - y : region[1] - y,\n            region[2] - x : region[3] - x,\n        ],\n        axis = (0, 1)\n    )\n\n    ax.plot(wl, mean_rfl, label='Isofit', c='black')\n\n    ax.set_ylabel('Reflectance')\n    ax.set_title(roi)\n    ax.legend()\n\nax.set_xlabel('Wavelength')\nplt.tight_layout()\n</pre> fig, axes = plt.subplots(len(regions), sharex=True, figsize=(10, 3*len(regions)))  for i, (roi, region) in enumerate(regions.items()):     ax = axes[i]      in_situ = np.genfromtxt(paths.insitu / f'{roi}01/Data/{roi}01_Refl.dat', skip_header=3)     ax.plot(in_situ[:, 0], in_situ[:, 1], label='In Situ', c='red', ls='-')      mean_rfl = np.mean(         rfl[             region[0] - y : region[1] - y,             region[2] - x : region[3] - x,         ],         axis = (0, 1)     )      ax.plot(wl, mean_rfl, label='Isofit', c='black')      ax.set_ylabel('Reflectance')     ax.set_title(roi)     ax.legend()  ax.set_xlabel('Wavelength') plt.tight_layout() <p>We can plot out the mapped reflectance (as above), but also the interpolated atmospheric conditions.  The windows size is small enough here (and the atmospheric parameters are chosen in such a way) that the map is going to be pretty static...but we can still see it.</p> In\u00a0[12]: Copied! <pre>dat = envi.open(paths.working / f\"output/{neon_str}_atm_interp.hdr\")\natm = dat.open_memmap(interleave='bip').copy()\n\nplt.figure(figsize=(7, 7))\nplt.title('AOD')\nplt.imshow(atm[..., 0])\nplt.colorbar()\n\nplt.figure(figsize=(7, 7))\nplt.title('Water Vapor')\nplt.imshow(atm[..., 1])\nplt.colorbar()\n</pre> dat = envi.open(paths.working / f\"output/{neon_str}_atm_interp.hdr\") atm = dat.open_memmap(interleave='bip').copy()  plt.figure(figsize=(7, 7)) plt.title('AOD') plt.imshow(atm[..., 0]) plt.colorbar()  plt.figure(figsize=(7, 7)) plt.title('Water Vapor') plt.imshow(atm[..., 1]) plt.colorbar() Out[12]: <pre>&lt;matplotlib.colorbar.Colorbar at 0x7f34b5434190&gt;</pre>"},{"location":"notebooks/neon/#neon","title":"NEON\u00b6","text":"<p>This notebook is an excercise in executing ISOFIT on two dates from the NEON dataset and interpreting the outputs of ISOFIT.</p> <p>Prerequisites:</p> <ul> <li>Have ISOFIT installed and sRTMnet configured.</li> <li>Download the subset_data.zip and place the unzipped <code>data</code> directory into tutorial's repository root. Alternatively, use <code>isofit download examples --neon</code> to automate this process.</li> </ul> <p>Note: If you downloaded the ISOFIT extra data via <code>isofit download</code>, both sRTMnet and the NEON data files will be installed correctly and available with default settings for this notebook.</p>"},{"location":"notebooks/neon/#setup","title":"Setup\u00b6","text":"<p>ISOFIT needs at minimum three pieces as input:</p> <pre><code>1. Radiance measurements (rdn)\n2. Observation values    (obs)\n3. Location information  (loc)</code></pre> <p>This sample dataset from NEON has radiance and observation data, but no location values (more recent NEON datasets include the location file).  However, we can 'fake' the location file with sufficient accuracy for ISOFIT to run successfully.  Note that there are data available for two dates:</p> <pre><code>Radiance\n\u251c\u2500\u2500 173647\n\u2502   \u251c\u2500\u2500 NIS01_20210403_173647_obs_ort\n\u2502   \u251c\u2500\u2500 NIS01_20210403_173647_obs_ort.hdr\n\u2502   \u251c\u2500\u2500 NIS01_20210403_173647_rdn_ort\n\u2502   \u2514\u2500\u2500 NIS01_20210403_173647_rdn_ort.hdr\n\u2514\u2500\u2500 174150\n    \u251c\u2500\u2500 NIS01_20210403_174150_obs_ort\n    \u251c\u2500\u2500 NIS01_20210403_174150_obs_ort.hdr\n    \u251c\u2500\u2500 NIS01_20210403_174150_rdn_ort\n    \u2514\u2500\u2500 NIS01_20210403_174150_rdn_ort.hdr\n</code></pre> <p>These files have corresponding in situ data as well, and below we've encoded the locations of each, which we can use to help subset data files.</p>"},{"location":"notebooks/neon/#apply-oe","title":"Apply OE\u00b6","text":"<p>The next part walks through running the ISOFIT utility script <code>isofit/utils/apply_oe.py</code>. This is the first step of executing ISOFIT and will generate a default configuration.</p>"},{"location":"notebooks/neon/#plotting","title":"Plotting\u00b6","text":"<p>Below plots the regions of interest defined by a NEON report.</p>"},{"location":"notebooks/neon_single_pixel/","title":"NEON Single Pixel","text":"In\u00a0[1]: Copied! <pre>%matplotlib inline\n\nimport os\nimport logging\nfrom pathlib import Path\nfrom types import SimpleNamespace\n\nimport matplotlib.pyplot as plt\nimport numpy as np\nfrom spectral.io import envi\n\nfrom isofit.core.isofit import Isofit\nfrom isofit.core.fileio import IO\nfrom isofit.core.forward import ForwardModel\nfrom isofit.data import env\nfrom isofit.inversion.inverse import Inversion\nfrom isofit.inversion.inverse_simple import invert_algebraic\nfrom isofit.configs import configs\nfrom isofit.core.geometry import Geometry\n\nlogging.getLogger().setLevel(logging.INFO)\n</pre> %matplotlib inline  import os import logging from pathlib import Path from types import SimpleNamespace  import matplotlib.pyplot as plt import numpy as np from spectral.io import envi  from isofit.core.isofit import Isofit from isofit.core.fileio import IO from isofit.core.forward import ForwardModel from isofit.data import env from isofit.inversion.inverse import Inversion from isofit.inversion.inverse_simple import invert_algebraic from isofit.configs import configs from isofit.core.geometry import Geometry  logging.getLogger().setLevel(logging.INFO) In\u00a0[2]: Copied! <pre># Extract the image locations of each point of interest (POI)\n# These are defined in the NEON report as pixel locations, so we round here to convert to indices\nreport = {}\nreport['173647'] = {     # Upp L Y  | Low R Y  | Upp L X | Low R X\n    'WhiteTarp': np.round([2224.9626, 2230.9771, 316.0078, 324.9385,]).astype(int),\n    'BlackTarp': np.round([2224.9626, 2231.0032, 328.0086, 333.9731,]).astype(int),\n    'Veg'      : np.round([2245.0381, 2258.8103, 343.9006, 346.9423,]).astype(int),\n    'RoadEW'   : np.round([2214.9905, 2216.9978, 348.9902, 373.0080,]).astype(int),\n    'RoadNS'   : np.round([2205.9580, 2225.9612, 357.9536, 359.9608,]).astype(int)\n}\nreport['174150'] = {     # Upp L Y | Low R Y | Upp L X  | Low R X\n    'WhiteTarp': np.round([653.9626, 659.9771, 3143.0078, 3151.9385]).astype(int),\n    'BlackTarp': np.round([653.9626, 660.0032, 3155.0086, 3160.9731]).astype(int),\n    'Veg'      : np.round([674.0381, 687.8103, 3170.9006, 3173.9423]).astype(int),\n    'RoadEW'   : np.round([643.9905, 645.9978, 3175.9902, 3200.0080]).astype(int),\n    'RoadNS'   : np.round([634.9580, 654.9612, 3184.9536, 3186.9608]).astype(int)\n}\n\n# Which NEON date to process - change this to process a different date\nneon_id  = list(report.keys())[0]\nneon_str = f\"NIS01_20210403_{neon_id}\"\n\n# Select the locations from the neon id -- roi == Regions of Interest\nroi = report[neon_id]\n</pre> # Extract the image locations of each point of interest (POI) # These are defined in the NEON report as pixel locations, so we round here to convert to indices report = {} report['173647'] = {     # Upp L Y  | Low R Y  | Upp L X | Low R X     'WhiteTarp': np.round([2224.9626, 2230.9771, 316.0078, 324.9385,]).astype(int),     'BlackTarp': np.round([2224.9626, 2231.0032, 328.0086, 333.9731,]).astype(int),     'Veg'      : np.round([2245.0381, 2258.8103, 343.9006, 346.9423,]).astype(int),     'RoadEW'   : np.round([2214.9905, 2216.9978, 348.9902, 373.0080,]).astype(int),     'RoadNS'   : np.round([2205.9580, 2225.9612, 357.9536, 359.9608,]).astype(int) } report['174150'] = {     # Upp L Y | Low R Y | Upp L X  | Low R X     'WhiteTarp': np.round([653.9626, 659.9771, 3143.0078, 3151.9385]).astype(int),     'BlackTarp': np.round([653.9626, 660.0032, 3155.0086, 3160.9731]).astype(int),     'Veg'      : np.round([674.0381, 687.8103, 3170.9006, 3173.9423]).astype(int),     'RoadEW'   : np.round([643.9905, 645.9978, 3175.9902, 3200.0080]).astype(int),     'RoadNS'   : np.round([634.9580, 654.9612, 3184.9536, 3186.9608]).astype(int) }  # Which NEON date to process - change this to process a different date neon_id  = list(report.keys())[0] neon_str = f\"NIS01_20210403_{neon_id}\"  # Select the locations from the neon id -- roi == Regions of Interest roi = report[neon_id] In\u00a0[3]: Copied! <pre># Below are the default values for the ISOFIT environment. Change these if your environment differs\n\nenv.load('~/.isofit/isofit.ini') # Ini file to load\nenv.changeSection('DEFAULT')     # Section of the ini to use\n# env.changeBase('~./isofit')      # Base path for ISOFIT extras (data, examples, etc)\n# env.changePath('srtmnet', '/path/to/sRTMnet_v120.h5') # Overwrite the path to sRTMnet - copy this line for other products such as sixs if in non-default locations\n\nprint('Using environment paths:')\nfor key, path in env.items():\n    print(f\"- {key} = {path}\")\n</pre> # Below are the default values for the ISOFIT environment. Change these if your environment differs  env.load('~/.isofit/isofit.ini') # Ini file to load env.changeSection('DEFAULT')     # Section of the ini to use # env.changeBase('~./isofit')      # Base path for ISOFIT extras (data, examples, etc) # env.changePath('srtmnet', '/path/to/sRTMnet_v120.h5') # Overwrite the path to sRTMnet - copy this line for other products such as sixs if in non-default locations  print('Using environment paths:') for key, path in env.items():     print(f\"- {key} = {path}\") <pre>Using environment paths:\n- data = /home/runner/work/isofit-tutorials/data\n- examples = /home/runner/work/isofit-tutorials/isofit-tutorials\n- imagecube = /home/runner/work/isofit-tutorials/imagecube\n- srtmnet = /home/runner/work/isofit-tutorials/srtmnet\n- sixs = /home/runner/work/isofit-tutorials/sixs\n- surface = /home/runner/work/isofit-tutorials/surface\n- plots = /home/runner/work/isofit-tutorials/plots\n- libradtran = /home/runner/work/isofit-tutorials/libradtran\n- srtmnet.file = sRTMnet_v120.h5\n- srtmnet.aux = sRTMnet_v120_aux.npz\n- libradtran.version = libRadtran-2.0.6\n</pre> In\u00a0[4]: Copied! <pre># Set the paths for this tutorial\nbase = Path(env.path('examples', 'NEON'))\nraws = base / 'data'\ndata = base / 'neon_subset'\n\npaths = SimpleNamespace(\n    rdn = str(data / f'{neon_str}_rdn_ort'),\n    loc = str(data / f'{neon_str}_loc_ort'),\n    obs = str(data / f'{neon_str}_obs_ort'),\n    insitu = raws,\n    output = base / 'output',\n    working = base / f'output/NIS01_20210403_{neon_id}',\n    surface = str(base / 'output/surface.mat'),\n    surface_config = env.path('examples', '20171108_Pasadena', 'configs', 'ang20171108t184227_surface.json')\n)\n</pre> # Set the paths for this tutorial base = Path(env.path('examples', 'NEON')) raws = base / 'data' data = base / 'neon_subset'  paths = SimpleNamespace(     rdn = str(data / f'{neon_str}_rdn_ort'),     loc = str(data / f'{neon_str}_loc_ort'),     obs = str(data / f'{neon_str}_obs_ort'),     insitu = raws,     output = base / 'output',     working = base / f'output/NIS01_20210403_{neon_id}',     surface = str(base / 'output/surface.mat'),     surface_config = env.path('examples', '20171108_Pasadena', 'configs', 'ang20171108t184227_surface.json') ) In\u00a0[5]: Copied! <pre># Now run actual retrievals\nconfig = configs.create_new_config(paths.working / \"config\" / f\"{neon_str}_isofit.json\")\nconfig.input.measured_radiance_file = paths.rdn\nconfig.input.obs_file = paths.obs\nconfig.input.loc_file = paths.loc\n\nfm = ForwardModel(config)\nio = IO(config, fm)\ninv = Inversion(config, fm)\n</pre> # Now run actual retrievals config = configs.create_new_config(paths.working / \"config\" / f\"{neon_str}_isofit.json\") config.input.measured_radiance_file = paths.rdn config.input.obs_file = paths.obs config.input.loc_file = paths.loc  fm = ForwardModel(config) io = IO(config, fm) inv = Inversion(config, fm) <pre>INFO:root:Loading config file: /home/runner/work/isofit-tutorials/isofit-tutorials/NEON/output/NIS01_20210403_173647/config/NIS01_20210403_173647_isofit.json\n</pre> <pre>/home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/fromnumeric.py:3824: RuntimeWarning: Mean of empty slice\n  return _methods._mean(a, axis=axis, dtype=dtype,\n/home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/_methods.py:142: RuntimeWarning: invalid value encountered in scalar divide\n  ret = ret.dtype.type(ret / rcount)\nINFO:/home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/isofit/radiative_transfer/radiative_transfer_engine.py:Loading from wavelength_file: /home/runner/work/isofit-tutorials/isofit-tutorials/NEON/output/NIS01_20210403_173647/data/wavelengths.txt\n</pre> <pre>INFO:/home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/isofit/radiative_transfer/radiative_transfer_engine.py:Prebuilt LUT provided\n</pre> <pre>INFO:isofit.radiative_transfer.luts:Loading LUT into memory\n</pre> <pre>WARNING:isofit.radiative_transfer.luts:thermal_upwelling is fully NaN, leaving as-is\n</pre> <pre>WARNING:isofit.radiative_transfer.luts:thermal_downwelling is fully NaN, leaving as-is\n</pre> <pre>INFO:/home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/isofit/radiative_transfer/radiative_transfer_engine.py:LUT grid loaded from file\n</pre> In\u00a0[6]: Copied! <pre>region = \"Veg\"\n\n# Find the tightened bounding box of all the regions of interest\nr = np.stack(list(report[neon_id].values())).T\nY = r[0].min() - 5, r[1].max() + 5\nX = r[2].min() - 5, r[3].max() + 5\n\narea = roi[region]\nbounds = slice(*area[:2] - Y[0]), slice(*area[2:] - X[0])\n\nread = lambda file: np.mean(envi.open(file).open_memmap(interleave=\"bip\")[bounds].copy(), axis=(0, 1))\nrdn = read(f\"{config.input.measured_radiance_file}.hdr\")\nobs = read(f\"{config.input.obs_file}.hdr\")\nloc = read(f\"{config.input.loc_file}.hdr\")\n</pre> region = \"Veg\"  # Find the tightened bounding box of all the regions of interest r = np.stack(list(report[neon_id].values())).T Y = r[0].min() - 5, r[1].max() + 5 X = r[2].min() - 5, r[3].max() + 5  area = roi[region] bounds = slice(*area[:2] - Y[0]), slice(*area[2:] - X[0])  read = lambda file: np.mean(envi.open(file).open_memmap(interleave=\"bip\")[bounds].copy(), axis=(0, 1)) rdn = read(f\"{config.input.measured_radiance_file}.hdr\") obs = read(f\"{config.input.obs_file}.hdr\") loc = read(f\"{config.input.loc_file}.hdr\") In\u00a0[7]: Copied! <pre>geom = Geometry(obs=obs, loc=loc)\nstates = inv.invert(rdn, geom)\n\nx_surface, x_RT, x_instrument = fm.unpack(states[-1,:])\nrfl_est, coeffs = invert_algebraic(\n    fm.surface, \n    fm.RT, \n    fm.instrument, \n    x_surface, \n    x_RT, \n    x_instrument,\n    rdn, \n    geom,\n)\n</pre> geom = Geometry(obs=obs, loc=loc) states = inv.invert(rdn, geom)  x_surface, x_RT, x_instrument = fm.unpack(states[-1,:]) rfl_est, coeffs = invert_algebraic(     fm.surface,      fm.RT,      fm.instrument,      x_surface,      x_RT,      x_instrument,     rdn,      geom, ) <pre>WARNING:root:Earth sun distance not provided. Proceeding without might cause some inaccuracies down the line\n</pre> <pre>/home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/fromnumeric.py:3824: RuntimeWarning: Mean of empty slice\n  return _methods._mean(a, axis=axis, dtype=dtype,\n/home/runner/work/isofit-tutorials/isofit-tutorials/.venv/lib/python3.13/site-packages/numpy/_core/_methods.py:142: RuntimeWarning: invalid value encountered in scalar divide\n  ret = ret.dtype.type(ret / rcount)\n</pre> In\u00a0[8]: Copied! <pre>def closest_wl(mv):\n    return np.argmin(np.abs(io.meas_wl-mv))\n\nwl_nan = io.meas_wl.copy()\nwl_nan[closest_wl(1360):closest_wl(1410)] = np.nan\nwl_nan[closest_wl(1800):closest_wl(1970)] = np.nan\n\nfig = plt.figure(figsize=(14,5))\n\nfor n in range(0, states.shape[0], 3):\n    plt.plot(wl_nan, states[n, :-2] + 0.04*n,\n        label = f\"Step {n}\" if n else \"Algebraic Inversion at Initial Guess\"\n    )\n\nplt.legend()\n</pre> def closest_wl(mv):     return np.argmin(np.abs(io.meas_wl-mv))  wl_nan = io.meas_wl.copy() wl_nan[closest_wl(1360):closest_wl(1410)] = np.nan wl_nan[closest_wl(1800):closest_wl(1970)] = np.nan  fig = plt.figure(figsize=(14,5))  for n in range(0, states.shape[0], 3):     plt.plot(wl_nan, states[n, :-2] + 0.04*n,         label = f\"Step {n}\" if n else \"Algebraic Inversion at Initial Guess\"     )  plt.legend() Out[8]: <pre>&lt;matplotlib.legend.Legend at 0x7fe13ee68050&gt;</pre>"},{"location":"notebooks/neon_single_pixel/#neon-single-pixel","title":"NEON Single Pixel\u00b6","text":"<p>This notebook is an excercise in running ISOFIT in pixel mode (dynamically from python), in order to get into some configuation details.</p> <p>Prerequisites:</p> <ul> <li>Run the neon.ipynb notebook succesfully - we'll use some of the outputs created from that intiial sample run</li> </ul>"},{"location":"notebooks/neon_single_pixel/#running-per-pixel-retrievals","title":"Running Per-Pixel Retrievals\u00b6","text":"<p>That gave us a baseline run, but its not clear what might be improved. Let's load up some individual retrievals so we can understand the performance a bit better.</p> <p>To get started with executing ISOFIT for iterable improvements, ISOFIT is comprised of three primary pieces:</p> <ol> <li>The <code>ForwardModel</code> object</li> <li>The <code>IO</code> object</li> <li>The <code>Inverse</code> object</li> </ol> <p>There is also an <code>Isofit</code> object that holds each of the other three, and is commonly used for more generic runs (it is what is called by apply_oe).</p>"},{"location":"notebooks/neon_single_pixel/#inversions","title":"Inversions\u00b6","text":""},{"location":"notebooks/neon_single_pixel/#plotting","title":"Plotting\u00b6","text":""}]}